<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lintoria Hub V4.04</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --gold: #fbbf24;
            --gold-dark: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-primary: #050817;
            --bg-secondary: #0f172a;
            --bg-tertiary: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --border: rgba(148, 163, 184, 0.1);
            --border-gold: rgba(251, 191, 36, 0.3);
            --gradient-gold: linear-gradient(135deg, #f59e0b, #fbbf24, #fcd34d);
            --gradient-blue: linear-gradient(135deg, #1e40af, #2563eb, #3b82f6);
            --gradient-purple: linear-gradient(135deg, #7c3aed, #8b5cf6, #a78bfa);
            --rarity-common: #9ca3af;
            --rarity-uncommon: #22c55e;
            --rarity-rare: #3b82f6;
            --rarity-epic: #a855f7;
            --rarity-legendary: #fbbf24;
            --rarity-mythic: #ec4899;
            --rarity-divine: #06b6d4;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .bg-grid {
            position: absolute;
            width: 200%;
            height: 200%;
            background-image: 
                linear-gradient(rgba(37, 99, 235, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(37, 99, 235, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-50px, -50px); }
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--gold);
            border-radius: 50%;
            opacity: 0.3;
            animation: float 15s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.3; }
            90% { opacity: 0.3; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }

        .glow-orb {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.15;
            animation: orbFloat 10s ease-in-out infinite;
        }

        .glow-orb.blue { background: var(--primary); top: 20%; left: 10%; }
        .glow-orb.gold { background: var(--gold); top: 60%; right: 10%; animation-delay: -5s; }
        .glow-orb.purple { background: #8b5cf6; bottom: 20%; left: 30%; animation-delay: -2.5s; }

        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(30px, -30px) scale(1.1); }
        }

        .hidden { display: none !important; }

        .app-container {
            position: relative;
            z-index: 10;
            min-height: 100vh;
            padding: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .glass-card {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(251, 191, 36, 0.05));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(251, 191, 36, 0.5), transparent);
        }

        .glass-card:hover {
            border-color: var(--border-gold);
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .logo-container { display: flex; align-items: center; gap: 1rem; }

        .logo-icon {
            width: 56px;
            height: 56px;
            background: var(--gradient-gold);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 8px 32px rgba(251, 191, 36, 0.3);
            animation: logoPulse 3s ease-in-out infinite;
        }

        @keyframes logoPulse {
            0%, 100% { box-shadow: 0 8px 32px rgba(251, 191, 36, 0.3); }
            50% { box-shadow: 0 8px 48px rgba(251, 191, 36, 0.5); }
        }

        .logo-text {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2rem;
            font-weight: 800;
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .version-badge {
            background: rgba(251, 191, 36, 0.2);
            color: var(--gold);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-left: 0.5rem;
        }

        .disclaimer {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05));
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab-container {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
            padding: 0.75rem;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .tab-btn {
            padding: 0.65rem 1rem;
            background: rgba(37, 99, 235, 0.1);
            color: var(--text-secondary);
            border: 1px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .tab-btn:hover {
            background: rgba(251, 191, 36, 0.15);
            color: var(--text-primary);
            border-color: rgba(251, 191, 36, 0.3);
        }

        .tab-btn.active {
            background: var(--gradient-gold);
            color: #000;
            font-weight: 700;
            box-shadow: 0 4px 20px rgba(251, 191, 36, 0.4);
        }

        .form-group { margin-bottom: 1rem; }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--gold);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input, select {
            width: 100%;
            padding: 0.875rem 1rem;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus, select:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.1);
        }

        .form-input::placeholder { color: var(--text-muted); }

        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background: var(--gradient-blue);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before { left: 100%; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4); }
        .btn:active { transform: translateY(0); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn:disabled:hover::before { left: -100%; }

        .btn-success { background: var(--gradient-gold); color: #000; }
        .btn-success:hover { box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4); }

        .btn-danger { background: linear-gradient(135deg, #dc2626, #ef4444); }
        .btn-danger:hover { box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4); }

        .btn-sm { padding: 0.5rem 1rem; font-size: 0.8rem; border-radius: 8px; }

        .btn-outline { background: transparent; border: 2px solid var(--gold); color: var(--gold); }
        .btn-outline:hover { background: var(--gold); color: #000; }

        .balance-card {
            background: linear-gradient(135deg, #1e40af 0%, #7c3aed 50%, #f59e0b 100%);
            padding: 2rem;
            border-radius: 24px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(37, 99, 235, 0.3);
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .balance-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .balance-amount {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 3rem;
            font-weight: 900;
            position: relative;
            z-index: 1;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(251, 191, 36, 0.05));
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.25rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover { border-color: var(--gold); transform: translateY(-3px); }

        .stat-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--gold);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.25rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .section-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gold);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
        }

        .pack-card {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.15), rgba(15, 23, 42, 0.8));
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .pack-card:hover {
            border-color: var(--gold);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(251, 191, 36, 0.2);
        }

        .pack-card.selected {
            border-color: var(--gold);
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(15, 23, 42, 0.8));
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.3);
        }

        .pack-name { font-weight: 700; color: var(--gold); margin-bottom: 0.5rem; font-size: 0.9rem; }
        .pack-emojis { font-size: 1.25rem; margin: 0.5rem 0; letter-spacing: 2px; }

        .emoji-grid { display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; }

        .emoji-card {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            padding: 0.75rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .emoji-card:hover { transform: scale(1.15) rotate(5deg); z-index: 10; }
        .emoji-card .emoji { font-size: 2rem; margin-bottom: 0.25rem; }

        .emoji-card.common { background: rgba(156, 163, 175, 0.15); border: 2px solid var(--rarity-common); }
        .emoji-card.uncommon { background: rgba(34, 197, 94, 0.15); border: 2px solid var(--rarity-uncommon); }
        .emoji-card.rare { background: rgba(59, 130, 246, 0.15); border: 2px solid var(--rarity-rare); }
        .emoji-card.epic { background: rgba(168, 85, 247, 0.15); border: 2px solid var(--rarity-epic); }
        .emoji-card.legendary { background: rgba(251, 191, 36, 0.2); border: 2px solid var(--rarity-legendary); animation: legendaryGlow 2s ease-in-out infinite; }
        .emoji-card.mythic { background: rgba(236, 72, 153, 0.2); border: 2px solid var(--rarity-mythic); animation: mythicGlow 1.5s ease-in-out infinite; }
        .emoji-card.divine { background: linear-gradient(135deg, rgba(6, 182, 212, 0.3), rgba(168, 85, 247, 0.3)); border: 2px solid var(--rarity-divine); animation: divineGlow 1s ease-in-out infinite; }

        @keyframes legendaryGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(251, 191, 36, 0.5); }
            50% { box-shadow: 0 0 25px rgba(251, 191, 36, 0.8); }
        }

        @keyframes mythicGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(236, 72, 153, 0.5); }
            50% { box-shadow: 0 0 30px rgba(236, 72, 153, 0.9); }
        }

        @keyframes divineGlow {
            0%, 100% { box-shadow: 0 0 15px rgba(6, 182, 212, 0.6), 0 0 30px rgba(168, 85, 247, 0.4); }
            50% { box-shadow: 0 0 35px rgba(6, 182, 212, 1), 0 0 50px rgba(168, 85, 247, 0.8); }
        }

        .rarity-badge {
            display: inline-block;
            padding: 0.15rem 0.5rem;
            border-radius: 6px;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .rarity-badge.common { background: var(--rarity-common); color: #000; }
        .rarity-badge.uncommon { background: var(--rarity-uncommon); color: #000; }
        .rarity-badge.rare { background: var(--rarity-rare); color: #fff; }
        .rarity-badge.epic { background: var(--rarity-epic); color: #fff; }
        .rarity-badge.legendary { background: var(--rarity-legendary); color: #000; }
        .rarity-badge.mythic { background: var(--rarity-mythic); color: #fff; }
        .rarity-badge.divine { background: linear-gradient(135deg, var(--rarity-divine), #8b5cf6); color: #fff; }

        .casino-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .casino-game {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(15, 23, 42, 0.8));
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .casino-game:hover { border-color: var(--gold); box-shadow: 0 10px 40px rgba(251, 191, 36, 0.15); }

        .casino-game h3 {
            color: var(--gold);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .casino-game .game-desc { color: var(--text-muted); font-size: 0.75rem; margin-bottom: 1rem; }

        .game-result {
            margin-top: 1rem;
            text-align: center;
            font-weight: 700;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* PLINKO */
        .plinko-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0.5rem auto;
            background: linear-gradient(180deg, #0a0a1a, #151530);
            border-radius: 16px;
            padding: 12px;
            border: 3px solid var(--gold);
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.2), inset 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .plinko-board {
            position: relative;
            width: 100%;
            height: 420px;
            overflow: hidden;
        }

        .plinko-peg {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle at 30% 30%, #ffd700, #b8860b);
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.6);
            transform: translate(-50%, -50%);
        }

        .plinko-ball {
            position: absolute;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.8);
            z-index: 100;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .plinko-ball.ball-red { background: radial-gradient(circle at 30% 30%, #ff6b6b, #cc0000); }
        .plinko-ball.ball-blue { background: radial-gradient(circle at 30% 30%, #6b9dff, #0044cc); box-shadow: 0 0 15px rgba(107, 157, 255, 0.8); }
        .plinko-ball.ball-green { background: radial-gradient(circle at 30% 30%, #6bff8c, #00cc44); box-shadow: 0 0 15px rgba(107, 255, 140, 0.8); }
        .plinko-ball.ball-purple { background: radial-gradient(circle at 30% 30%, #b86bff, #7700cc); box-shadow: 0 0 15px rgba(184, 107, 255, 0.8); }
        .plinko-ball.ball-orange { background: radial-gradient(circle at 30% 30%, #ffb86b, #cc6600); box-shadow: 0 0 15px rgba(255, 184, 107, 0.8); }

        .plinko-slots {
            display: flex;
            justify-content: center;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            gap: 1px;
        }

        .plinko-slot {
            width: 30px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.55rem;
            font-weight: 800;
            border-radius: 4px 4px 0 0;
            color: white;
            transition: all 0.3s ease;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        .plinko-slot[data-mult="0.2"] { background: linear-gradient(180deg, #dc2626, #991b1b); }
        .plinko-slot[data-mult="0.5"] { background: linear-gradient(180deg, #f97316, #ea580c); }
        .plinko-slot[data-mult="1"] { background: linear-gradient(180deg, #eab308, #ca8a04); }
        .plinko-slot[data-mult="1.5"] { background: linear-gradient(180deg, #84cc16, #65a30d); }
        .plinko-slot[data-mult="2"] { background: linear-gradient(180deg, #22c55e, #16a34a); }
        .plinko-slot[data-mult="5"] { background: linear-gradient(180deg, #06b6d4, #0891b2); }

        .plinko-slot.active { transform: scaleY(1.2); box-shadow: 0 0 20px currentColor; }

        .plinko-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            font-size: 0.75rem;
        }

        .plinko-stats span { color: var(--gold); font-weight: 600; }

        /* ROULETTE */
        .roulette-container { position: relative; width: 240px; height: 240px; margin: 0.5rem auto; }

        .roulette-wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 6px solid var(--gold);
            box-shadow: 0 0 40px rgba(251, 191, 36, 0.4), inset 0 0 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            position: relative;
            background: #1a1a2e;
        }

        .roulette-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            left: 50%;
            top: 50%;
            transform-origin: 0 0;
            clip-path: polygon(0 0, 100% 0, 100% 100%);
        }

        .roulette-segment span {
            position: absolute;
            font-size: 0.6rem;
            font-weight: 700;
            color: white;
            left: 40%;
            top: 25%;
            transform: rotate(5deg);
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        .roulette-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: var(--gradient-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .roulette-pointer {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-top: 20px solid var(--gold);
            z-index: 20;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .roulette-bet-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin: 0.75rem 0;
        }

        .roulette-bet-btn {
            padding: 0.6rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: rgba(15, 23, 42, 0.8);
            color: var(--text-primary);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .roulette-bet-btn:hover { transform: translateY(-2px); }
        .roulette-bet-btn.selected { border-color: var(--gold); background: rgba(251, 191, 36, 0.2); }
        .roulette-bet-btn.red { border-color: #dc2626; }
        .roulette-bet-btn.red.selected { background: rgba(220, 38, 38, 0.3); }
        .roulette-bet-btn.black { border-color: #4b5563; }
        .roulette-bet-btn.black.selected { background: rgba(75, 85, 99, 0.3); }
        .roulette-bet-btn.green { border-color: #16a34a; }
        .roulette-bet-btn.green.selected { background: rgba(22, 163, 74, 0.3); }

        /* SLOTS */
        .slots-machine {
            background: linear-gradient(180deg, #1a1a2e, #0f0f1a);
            border-radius: 20px;
            padding: 1.25rem;
            max-width: 280px;
            margin: 0.5rem auto;
            border: 4px solid var(--gold);
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .slots-display {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            background: #0a0a0a;
            padding: 1rem;
            border-radius: 12px;
            border: 2px solid #333;
        }

        .slot-reel {
            width: 65px;
            height: 75px;
            background: linear-gradient(180deg, #1a1a1a, #2a2a2a);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.75rem;
            border: 2px solid #444;
            overflow: hidden;
        }

        .slot-reel.spinning .slot-symbol { animation: slotSpin 0.08s linear infinite; }

        @keyframes slotSpin {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        /* COIN */
        .coin-container { perspective: 400px; width: 90px; height: 90px; margin: 1rem auto; }

        .coin {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.1s;
        }

        .coin.flipping { animation: coinFlip 1.5s ease-out; }

        @keyframes coinFlip {
            0% { transform: rotateY(0) translateY(0); }
            50% { transform: rotateY(1800deg) translateY(-100px); }
            100% { transform: rotateY(3600deg) translateY(0); }
        }

        .coin-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.75rem;
            backface-visibility: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .coin-heads { background: linear-gradient(135deg, #ffd700, #ffed4a); border: 4px solid #b8860b; }
        .coin-tails { background: linear-gradient(135deg, #c0c0c0, #e8e8e8); border: 4px solid #808080; transform: rotateY(180deg); }

        /* DICE */
        .dice-container { perspective: 600px; width: 80px; height: 80px; margin: 1rem auto; }

        .dice {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dice.rolling { animation: rollDice 1s ease-out; }

        @keyframes rollDice {
            0% { transform: rotateX(0) rotateY(0) rotateZ(0); }
            25% { transform: rotateX(180deg) rotateY(90deg) rotateZ(45deg); }
            50% { transform: rotateX(360deg) rotateY(180deg) rotateZ(90deg); }
            75% { transform: rotateX(540deg) rotateY(270deg) rotateZ(135deg); }
            100% { transform: rotateX(720deg) rotateY(360deg) rotateZ(180deg); }
        }

        .dice-face {
            position: absolute;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #fff, #e5e5e5);
            border: 3px solid #333;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: #1a1a2e;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.1);
        }

        .dice-face.front { transform: translateZ(40px); }
        .dice-face.back { transform: rotateY(180deg) translateZ(40px); }
        .dice-face.right { transform: rotateY(90deg) translateZ(40px); }
        .dice-face.left { transform: rotateY(-90deg) translateZ(40px); }
        .dice-face.top { transform: rotateX(90deg) translateZ(40px); }
        .dice-face.bottom { transform: rotateX(-90deg) translateZ(40px); }

        /* CRASH */
        .crash-display {
            background: linear-gradient(180deg, #0a0a1a, #151530);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            border: 2px solid var(--border);
            min-height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .crash-multiplier {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 3rem;
            font-weight: 900;
            color: var(--success);
            transition: all 0.1s ease;
        }

        .crash-multiplier.crashed { color: var(--danger); }

        /* BLACKJACK */
        .blackjack-table {
            background: linear-gradient(180deg, #0d5c1d, #0a4a17);
            border-radius: 100px 100px 20px 20px;
            padding: 1.5rem;
            min-height: 200px;
            border: 8px solid #5c3d1e;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .bj-hand { margin-bottom: 1rem; }

        .bj-label {
            color: white;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .bj-cards {
            display: flex;
            justify-content: center;
            gap: 0.25rem;
            min-height: 75px;
        }

        .bj-card {
            width: 45px;
            height: 65px;
            background: white;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        }

        .bj-card.red { color: #dc2626; }
        .bj-card.black { color: #1f2937; }
        .bj-card.hidden { 
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,0.1) 5px, rgba(255,255,255,0.1) 10px);
        }

        /* CHEAT GAME */
        .cheat-game-area {
            background: linear-gradient(180deg, rgba(139, 92, 246, 0.1), rgba(168, 85, 247, 0.05));
            border-radius: 12px;
            padding: 1rem;
        }

        .cheat-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            justify-content: center;
            margin: 0.75rem 0;
        }

        .cheat-card {
            width: 45px;
            height: 62px;
            background: white;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .cheat-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .cheat-card.selected { 
            border-color: var(--gold); 
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.6);
            transform: translateY(-8px);
        }
        
        .cheat-card.red { color: #dc2626; }
        .cheat-card.black { color: #1f2937; }

        /* CHAT */
        .chat-container { display: flex; flex-direction: column; height: 400px; }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .chat-message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: rgba(37, 99, 235, 0.1);
            border-radius: 12px;
            border-left: 3px solid var(--gold);
        }

        .chat-username { font-weight: 700; color: var(--gold); font-size: 0.85rem; }
        .chat-time { font-size: 0.7rem; color: var(--text-muted); margin-left: 0.5rem; }
        .chat-text { margin-top: 0.25rem; color: var(--text-secondary); word-wrap: break-word; }
        .chat-input-container { display: flex; gap: 0.5rem; }
        .chat-input-container input { flex: 1; }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(15, 23, 42, 0.6));
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
        }

        .transaction-item:hover { border-color: var(--gold); transform: translateX(5px); }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(15, 23, 42, 0.6));
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover { border-color: var(--gold); transform: scale(1.02); }

        .leaderboard-item.current-user {
            border: 2px solid var(--gold);
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(15, 23, 42, 0.6));
        }

        .leaderboard-rank { font-size: 1.5rem; min-width: 50px; text-align: center; }
        .leaderboard-name { font-weight: 600; flex: 1; margin-left: 1rem; }
        .leaderboard-value { font-family: 'Space Grotesk', sans-serif; font-weight: 700; color: var(--gold); }

        /* LOANS */
        .loan-info-box {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .loan-info-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }

        .loan-label { display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.5rem; }
        .loan-value { display: block; font-size: 1.25rem; font-weight: 700; color: var(--gold); }

        .loan-preview {
            background: rgba(37, 99, 235, 0.1);
            border: 1px solid rgba(37, 99, 235, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .loans-list { display: flex; flex-direction: column; gap: 0.75rem; }

        .loan-card {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.05));
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 12px;
            padding: 1rem;
        }

        .loan-card.overdue {
            border-color: rgba(239, 68, 68, 0.5);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(185, 28, 28, 0.05));
        }

        /* STOCKS */
        .stocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .stock-card {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(59, 130, 246, 0.05));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.3s;
        }

        .stock-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }

        .stock-card.up { border-color: rgba(34, 197, 94, 0.5); }
        .stock-card.down { border-color: rgba(239, 68, 68, 0.5); }

        .stock-symbol { font-size: 1.25rem; font-weight: 800; color: var(--gold); }
        .stock-name { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.5rem; }
        .stock-price { font-size: 1.5rem; font-weight: 700; }
        .stock-change { font-size: 0.8rem; font-weight: 600; }
        .stock-change.up { color: #22c55e; }
        .stock-change.down { color: #ef4444; }

        .stock-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .stock-actions input { grid-column: 1 / -1; padding: 0.4rem; font-size: 0.75rem; }
        .stock-actions button { padding: 0.4rem; font-size: 0.7rem; }

        .holdings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
        }

        .holding-card {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.05));
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 12px;
            padding: 1rem;
        }

        .stock-admin-panel {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(168, 85, 247, 0.05));
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        /* MODALS */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 8, 23, 0.95);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .modal-overlay.active { opacity: 1; visibility: visible; }

        .modal-content {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-primary));
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal-content { transform: scale(1); }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h2 { color: var(--gold); font-size: 1.25rem; }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.75rem;
            cursor: pointer;
            transition: color 0.3s ease;
            line-height: 1;
        }

        .modal-close:hover { color: var(--danger); }

        .toast {
            position: fixed;
            top: 1.5rem;
            right: -400px;
            padding: 1rem 1.5rem;
            background: var(--gradient-blue);
            border-radius: 12px;
            transition: right 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 2000;
            color: white;
            font-weight: 600;
            min-width: 280px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .toast.show { right: 1.5rem; }
        .toast.success { background: linear-gradient(135deg, #059669, #10b981); }
        .toast.error { background: linear-gradient(135deg, #dc2626, #ef4444); }
        .toast.warning { background: linear-gradient(135deg, #d97706, #f59e0b); }

        .pack-opening {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(5, 8, 23, 0.95), rgba(5, 8, 23, 1));
            z-index: 3000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .pack-reveal { font-size: 8rem; animation: packReveal 1s cubic-bezier(0.68, -0.55, 0.265, 1.55); }

        @keyframes packReveal {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.3) rotate(10deg); }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }

        .pack-rarity-text {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2rem;
            font-weight: 900;
            margin-top: 1rem;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border); }
        .data-table th { color: var(--gold); font-weight: 600; font-size: 0.8rem; text-transform: uppercase; }
        .data-table tr:hover td { background: rgba(251, 191, 36, 0.05); }

        .empty-state { text-align: center; padding: 3rem; color: var(--text-muted); }
        .empty-icon { font-size: 4rem; opacity: 0.3; margin-bottom: 1rem; }

        .admin-card {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(15, 23, 42, 0.8));
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .user-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 10px;
            margin-bottom: 0.5rem;
        }

        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--gold-dark); }

        @media (max-width: 768px) {
            .app-container { padding: 1rem; }
            .logo-text { font-size: 1.5rem; }
            .balance-amount { font-size: 2.25rem; }
            .tab-btn { padding: 0.5rem 0.75rem; font-size: 0.75rem; }
            .casino-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="bg-animation">
        <div class="bg-grid"></div>
        <div class="glow-orb blue"></div>
        <div class="glow-orb gold"></div>
        <div class="glow-orb purple"></div>
    </div>

    <div class="app-container">
        <!-- AUTH SCREEN -->
        <div id="authScreen">
            <div style="max-width: 420px; margin: 0 auto; padding-top: 2rem;">
                <div class="logo-container" style="justify-content: center; margin-bottom: 2rem;">
                    <div class="logo-icon">üèõÔ∏è</div>
                    <span class="logo-text">Lintoria</span>
                    <span class="version-badge">V4.04</span>
                </div>
                
                <div class="disclaimer">
                    <span>‚ö†Ô∏è</span>
                    <span><strong>DISCLAIMER:</strong> This is a simulation with fake money for educational purposes only. Not intended for actual gambling.</span>
                </div>

                <div class="glass-card">
                    <div class="tab-container" style="margin-bottom: 1.5rem;">
                        <button class="tab-btn active" onclick="switchAuthTab('login')" style="flex: 1;">üîê Login</button>
                        <button class="tab-btn" onclick="switchAuthTab('register')" style="flex: 1;">‚ú® Register</button>
                    </div>

                    <div id="loginTab">
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" id="loginEmail" class="form-input" placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" id="loginPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <button class="btn btn-success" onclick="login()" style="width: 100%;">Sign In ‚Üí</button>
                    </div>

                    <div id="registerTab" class="hidden">
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" id="registerEmail" class="form-input" placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Display Name</label>
                            <input type="text" id="registerName" class="form-input" placeholder="Your name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" id="registerPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <button class="btn btn-success" onclick="register()" style="width: 100%;">Create Account ‚ú®</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MAIN APP -->
        <div id="appScreen" class="hidden">
            <div class="glass-card" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <div class="logo-container" style="margin: 0;">
                    <div class="logo-icon">üèõÔ∏è</div>
                    <div>
                        <div style="display: flex; align-items: center;">
                            <span class="logo-text" style="font-size: 1.5rem;">Lintoria</span>
                            <span class="version-badge">V4.04</span>
                        </div>
                        <div style="color: var(--text-muted); font-size: 0.8rem;">
                            Welcome, <span id="userName" style="color: var(--gold); font-weight: 700;"></span>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <button class="btn btn-sm btn-outline" onclick="showSettingsModal()">‚öôÔ∏è</button>
                    <button class="btn btn-sm btn-danger" onclick="logout()">Logout</button>
                </div>
            </div>

            <div class="tab-container">
                <button class="tab-btn active" onclick="switchTab('dashboard')">üè¶ Bank</button>
                <button class="tab-btn" onclick="switchTab('transfer')">üí∏ Transfer</button>
                <button class="tab-btn" onclick="switchTab('loans')">üí≥ Loans</button>
                <button class="tab-btn" onclick="switchTab('stocks')">üìà Stocks</button>
                <button class="tab-btn" onclick="switchTab('packs')">üéÅ Packs</button>
                <button class="tab-btn" onclick="switchTab('collection')">üéí Collection</button>
                <button class="tab-btn" onclick="switchTab('casino')">üé∞ Casino</button>
                <button class="tab-btn" onclick="switchTab('chat')">üí¨ Chat</button>
                <button class="tab-btn" onclick="switchTab('leaderboard')">üèÜ Leaders</button>
                <button class="tab-btn" onclick="switchTab('admin')" id="adminTab" style="display: none;">üëë Admin</button>
            </div>

            <!-- DASHBOARD -->
            <div id="dashboardContent" class="tab-content">
                <div class="balance-card">
                    <div class="balance-label">Total Balance</div>
                    <div class="balance-amount">$<span id="balanceAmount">0</span></div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="creditScoreDisplay">650</div>
                        <div class="stat-label">Credit Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="emojiScoreDisplay">0</div>
                        <div class="stat-label">Emoji Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalWageredDisplay">$0</div>
                        <div class="stat-label">Total Wagered</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="netGamblingDisplay">$0</div>
                        <div class="stat-label">Net Gambling</div>
                    </div>
                </div>

                <div class="glass-card">
                    <div class="section-header">
                        <h2>üìú Recent Transactions</h2>
                        <button class="btn btn-sm" onclick="loadTransactions()">Refresh</button>
                    </div>
                    <div id="transactionsList">
                        <div class="empty-state"><div class="empty-icon">üìú</div><p>No transactions yet</p></div>
                    </div>
                </div>
            </div>

            <!-- TRANSFER -->
            <div id="transferContent" class="tab-content hidden">
                <div class="glass-card">
                    <div class="section-header"><h2>üí∏ Send Money</h2></div>
                    <div class="form-group">
                        <label class="form-label">Recipient Email</label>
                        <input type="email" id="recipientEmail" class="form-input" placeholder="recipient@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount ($)</label>
                        <input type="number" id="transferAmount" class="form-input" placeholder="0.00" min="0.01" step="0.01">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Note (Optional)</label>
                        <input type="text" id="transferNote" class="form-input" placeholder="What's this for?">
                    </div>
                    <button class="btn btn-success" onclick="transferMoney()" style="width: 100%;">üí∏ Send Money</button>
                </div>
            </div>

            <!-- LOANS -->
            <div id="loansContent" class="tab-content hidden">
                <div class="glass-card">
                    <div class="section-header"><h2>üí≥ Loans</h2></div>
                    <div class="loan-info-box">
                        <div class="loan-info-item">
                            <span class="loan-label">Your Credit Score</span>
                            <span class="loan-value" id="loanCreditScore">650</span>
                        </div>
                        <div class="loan-info-item">
                            <span class="loan-label">Max Loan</span>
                            <span class="loan-value" id="maxLoanAmount">$50,000</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Loan Amount ($)</label>
                        <input type="number" id="loanAmount" class="form-input" placeholder="Enter amount" min="1000" step="1000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Loan Term</label>
                        <select id="loanTerm" class="form-input">
                            <option value="7">7 days</option>
                            <option value="14" selected>14 days</option>
                            <option value="30">30 days</option>
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="applyForLoan()" style="width: 100%;">üí≥ Apply for Loan</button>
                    <div class="section-header" style="margin-top: 2rem;"><h3>üìã Active Loans</h3></div>
                    <div id="activeLoansList" class="loans-list">
                        <div class="empty-state"><p>No active loans</p></div>
                    </div>
                </div>
            </div>

            <!-- STOCKS -->
            <div id="stocksContent" class="tab-content hidden">
                <div class="glass-card">
                    <div class="section-header">
                        <h2>üìà Stock Market</h2>
                        <button class="btn btn-sm" onclick="loadStocks()">üîÑ Refresh</button>
                    </div>
                    <div id="stockAdminPanel" class="stock-admin-panel" style="display: none;">
                        <h3 style="color: var(--gold); margin-bottom: 1rem;">üîß Stock Admin</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; margin-bottom: 1rem;">
                            <input type="text" id="newStockSymbol" class="form-input" placeholder="Symbol">
                            <input type="text" id="newStockName" class="form-input" placeholder="Name">
                            <input type="number" id="newStockPrice" class="form-input" placeholder="Price">
                            <input type="number" id="newStockShares" class="form-input" placeholder="Shares">
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                            <button class="btn btn-success" onclick="createNewStock()">‚ûï Add</button>
                            <button class="btn btn-danger" onclick="removeStock()">üóëÔ∏è Remove</button>
                        </div>
                    </div>
                    <div id="stocksList" class="stocks-grid"><div class="empty-state"><p>Loading...</p></div></div>
                    <div class="section-header" style="margin-top: 1.5rem;"><h2>üíº Your Holdings</h2></div>
                    <div id="holdingsList" class="holdings-grid"><div class="empty-state"><p>No stocks owned</p></div></div>
                </div>
            </div>

            <!-- PACKS -->
            <div id="packsContent" class="tab-content hidden">
                <div class="glass-card">
                    <div class="section-header">
                        <h2>üéÅ Emoji Packs</h2>
                        <button class="btn btn-sm" onclick="showChancesModal()">üìä Rates</button>
                    </div>
                    <div style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(37, 99, 235, 0.1)); border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem; text-align: center;">
                        <p style="font-size: 1.5rem; color: var(--gold); font-weight: 800;">$7,500 per pack</p>
                    </div>
                    <div class="service-grid" id="packsList" style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));"></div>
                    <div style="margin-top: 1.5rem; text-align: center;">
                        <button class="btn btn-success" onclick="buyPack()" id="buyPackBtn" style="font-size: 1.1rem; padding: 1rem 2rem;" disabled>üéÅ Open Pack</button>
                        <p id="selectedPackName" style="color: var(--text-muted); margin-top: 0.75rem;">Select a pack above</p>
                    </div>
                </div>
            </div>

            <!-- COLLECTION -->
            <div id="collectionContent" class="tab-content hidden">
                <div class="glass-card">
                    <div class="section-header">
                        <h2>üéí Your Collection</h2>
                        <span style="color: var(--gold); font-weight: 700;" id="emojiScoreHeader">0 pts</span>
                    </div>
                    <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 1rem;">Click any emoji to sell it!</p>
                    <div id="emojiCollection" class="emoji-grid">
                        <div class="empty-state"><div class="empty-icon">üéí</div><p>No emojis yet</p></div>
                    </div>
                </div>
            </div>

            <!-- CASINO -->
            <div id="casinoContent" class="tab-content hidden">
                <div class="glass-card">
                    <div class="section-header"><h2>üé∞ Casino</h2></div>
                    <div class="casino-grid">
                        <!-- PLINKO -->
                        <div class="casino-game">
                            <h3>üìç Plinko</h3>
                            <p class="game-desc">Drop balls and win up to 5x!</p>
                            <div class="plinko-container">
                                <div class="plinko-board" id="plinkoBoard"></div>
                            </div>
                            <div class="plinko-stats">
                                <div>Active: <span id="plinkoBallCount">0</span></div>
                                <div>Won: <span id="plinkoTotalWon">$0</span></div>
                            </div>
                            <input type="number" id="plinkoBet" class="form-input" placeholder="Bet" min="1" style="margin: 0.75rem 0;">
                            <button class="btn btn-success" onclick="dropPlinkoBall()" style="width: 100%;">üé± Drop</button>
                            <div class="game-result" id="plinkoResult"></div>
                        </div>

                        <!-- ROULETTE -->
                        <div class="casino-game">
                            <h3>üé° Roulette</h3>
                            <p class="game-desc">Red/Black 1.8x ‚Ä¢ Green 14x</p>
                            <div class="roulette-container">
                                <div class="roulette-pointer"></div>
                                <div class="roulette-wheel" id="rouletteWheel"></div>
                                <div class="roulette-center">üé∞</div>
                            </div>
                            <div class="roulette-bet-options">
                                <button class="roulette-bet-btn red" onclick="selectRouletteBet('red')" id="betRed">üî¥ Red</button>
                                <button class="roulette-bet-btn black" onclick="selectRouletteBet('black')" id="betBlack">‚ö´ Black</button>
                                <button class="roulette-bet-btn green" onclick="selectRouletteBet('green')" id="betGreen">üü¢ Green</button>
                            </div>
                            <input type="number" id="rouletteBet" class="form-input" placeholder="Bet" min="1" style="margin: 0.5rem 0;">
                            <button class="btn" onclick="playRoulette()" id="rouletteBtn" style="width: 100%;" disabled>üé° Spin</button>
                            <div class="game-result" id="rouletteResult"></div>
                        </div>

                        <!-- SLOTS -->
                        <div class="casino-game">
                            <h3>üé∞ Slots</h3>
                            <p class="game-desc">Match 3 for up to 25x!</p>
                            <div class="slots-machine">
                                <div class="slots-display">
                                    <div class="slot-reel" id="reel1"><span class="slot-symbol">üé∞</span></div>
                                    <div class="slot-reel" id="reel2"><span class="slot-symbol">üé∞</span></div>
                                    <div class="slot-reel" id="reel3"><span class="slot-symbol">üé∞</span></div>
                                </div>
                            </div>
                            <input type="number" id="slotsBet" class="form-input" placeholder="Bet" min="1" style="margin: 0.75rem 0;">
                            <button class="btn btn-success" onclick="playSlots()" style="width: 100%;">üé∞ Spin</button>
                            <div class="game-result" id="slotsResult"></div>
                        </div>

                        <!-- COIN FLIP -->
                        <div class="casino-game">
                            <h3>ü™ô Coin Flip</h3>
                            <p class="game-desc">45% win chance, 1.9x payout</p>
                            <div class="coin-container">
                                <div class="coin" id="coin">
                                    <div class="coin-face coin-heads">üëë</div>
                                    <div class="coin-face coin-tails">ü¶Ö</div>
                                </div>
                            </div>
                            <input type="number" id="coinBet" class="form-input" placeholder="Bet" min="1" style="margin: 0.75rem 0;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                <button class="btn" onclick="playCoinFlip('heads')">üëë Heads</button>
                                <button class="btn btn-success" onclick="playCoinFlip('tails')">ü¶Ö Tails</button>
                            </div>
                            <div class="game-result" id="coinResult"></div>
                        </div>

                        <!-- DICE -->
                        <div class="casino-game">
                            <h3>üé≤ Dice</h3>
                            <p class="game-desc">Roll 4-6 to win 1.9x</p>
                            <div class="dice-container">
                                <div class="dice" id="dice">
                                    <div class="dice-face front">‚öÄ</div>
                                    <div class="dice-face back">‚öÖ</div>
                                    <div class="dice-face right">‚öÇ</div>
                                    <div class="dice-face left">‚öÉ</div>
                                    <div class="dice-face top">‚öÅ</div>
                                    <div class="dice-face bottom">‚öÑ</div>
                                </div>
                            </div>
                            <input type="number" id="diceBet" class="form-input" placeholder="Bet" min="1" style="margin: 0.75rem 0;">
                            <button class="btn" onclick="playDice()" style="width: 100%;">üé≤ Roll</button>
                            <div class="game-result" id="diceResult"></div>
                        </div>

                        <!-- CRASH -->
                        <div class="casino-game">
                            <h3>üìà Crash</h3>
                            <p class="game-desc">Cash out before crash!</p>
                            <div class="crash-display">
                                <div class="crash-multiplier" id="crashMultiplier">1.00x</div>
                                <div id="crashStatus" style="color: var(--text-muted); margin-top: 0.5rem;">Place bet</div>
                            </div>
                            <input type="number" id="crashBet" class="form-input" placeholder="Bet" min="1" style="margin: 0.75rem 0;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                <button class="btn btn-success" onclick="startCrash()" id="crashStartBtn">üöÄ Start</button>
                                <button class="btn btn-danger" onclick="cashoutCrash()" id="crashCashoutBtn" disabled>üí∞ Cash Out</button>
                            </div>
                            <div class="game-result" id="crashResult"></div>
                        </div>

                        <!-- BLACKJACK -->
                        <div class="casino-game">
                            <h3>üÉè Blackjack</h3>
                            <p class="game-desc">Beat the dealer!</p>
                            <div class="blackjack-table">
                                <div class="bj-hand">
                                    <div class="bj-label">Dealer: <span id="dealerScore">0</span></div>
                                    <div class="bj-cards" id="dealerCards"></div>
                                </div>
                                <div class="bj-hand">
                                    <div class="bj-label">You: <span id="playerScore">0</span></div>
                                    <div class="bj-cards" id="playerCards"></div>
                                </div>
                            </div>
                            <input type="number" id="bjBet" class="form-input" placeholder="Bet" min="1" style="margin: 0.75rem 0;">
                            <div id="bjControls">
                                <button class="btn btn-success" onclick="startBlackjack()" style="width: 100%;">üÉè Deal</button>
                            </div>
                            <div id="bjGameControls" style="display: none; gap: 0.5rem; grid-template-columns: repeat(3, 1fr);">
                                <button class="btn" onclick="bjHit()">Hit</button>
                                <button class="btn" onclick="bjStand()">Stand</button>
                                <button class="btn btn-success" onclick="bjDouble()">Double</button>
                            </div>
                            <div class="game-result" id="bjResult"></div>
                        </div>

                        <!-- CHEAT (Multiplayer) -->
                        <div class="casino-game">
                            <h3>üé≠ Cheat</h3>
                            <p class="game-desc">Bluff your way to victory! (2+ players required)</p>
                            <div class="cheat-game-area">
                                <div id="cheatStatus" style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px; margin-bottom: 1rem;">
                                    <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">üé¥ Loading...</div>
                                </div>
                                <div id="cheatCardsContainer" style="display: none;">
                                    <div style="font-size: 0.8rem; color: var(--gold); margin-bottom: 0.5rem; text-align: center;">Your Cards:</div>
                                    <div id="cheatCards" class="cheat-cards"></div>
                                    <div style="text-align: center; margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-muted);">
                                        Selected: <span id="cheatSelectedCount">0</span>
                                    </div>
                                </div>
                                <div id="cheatPileArea" style="text-align: center; margin: 1rem 0; padding: 0.75rem; background: rgba(251, 191, 36, 0.1); border-radius: 8px; display: none;">
                                    <div>Pile: <span id="cheatPileCount" style="color: var(--gold); font-weight: 700;">0</span></div>
                                    <div style="font-size: 0.85rem;">Claim: <span id="cheatCurrentClaim" style="font-weight: 700;">-</span></div>
                                </div>
                                <div id="cheatLastPlayInfo" style="display: none; background: rgba(139, 92, 246, 0.15); border-radius: 8px; padding: 0.75rem; margin-bottom: 0.75rem;">
                                    <div id="cheatLastPlayDetails" style="font-size: 0.9rem; color: var(--gold);"></div>
                                </div>
                            </div>
                            <input type="number" id="cheatBet" class="form-input" placeholder="Buy-in ($100 min)" min="100" value="100" style="margin: 0.75rem 0;">
                            <div id="cheatLobbyControls"></div>
                            <div id="cheatGameControls" style="display: none;"></div>
                            <div class="game-result" id="cheatResult"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CHAT -->
            <div id="chatContent" class="tab-content hidden">
                <div class="glass-card">
                    <div class="section-header">
                        <h2>üí¨ Chat</h2>
                        <button class="btn btn-sm" onclick="loadChat()">üîÑ</button>
                    </div>
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages"></div>
                        <div class="chat-input-container">
                            <input type="text" id="chatInput" class="form-input" placeholder="Message..." onkeypress="if(event.key==='Enter')sendChat()">
                            <button class="btn btn-success" onclick="sendChat()">Send</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LEADERBOARD -->
            <div id="leaderboardContent" class="tab-content hidden">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                    <div class="glass-card">
                        <div class="section-header"><h2>üí∞ Wealth</h2></div>
                        <div id="wealthLeaderboard"></div>
                    </div>
                    <div class="glass-card">
                        <div class="section-header"><h2>üéí Emoji Score</h2></div>
                        <div id="emojiLeaderboard"></div>
                    </div>
                </div>
            </div>

            <!-- ADMIN -->
            <div id="adminContent" class="tab-content hidden">
                <div class="glass-card admin-card">
                    <div class="section-header"><h2>üëë Admin Panel</h2></div>
                    <div id="adminUsersList"></div>
                </div>
                <div class="glass-card admin-card">
                    <div class="section-header"><h2>üí∞ Add Money</h2></div>
                    <div class="form-group">
                        <label class="form-label">User Email</label>
                        <input type="email" id="adminTargetEmail" class="form-input" placeholder="user@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount</label>
                        <input type="number" id="adminAddAmount" class="form-input" placeholder="Amount">
                    </div>
                    <button class="btn btn-danger" onclick="adminAddMoney()" style="width: 100%;">üí∞ Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="toast" class="toast"><span id="toastIcon">‚ÑπÔ∏è</span><span id="toastMessage"></span></div>

    <div class="modal-overlay" id="chancesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìä Drop Rates</h2>
                <button class="modal-close" onclick="closeChancesModal()">√ó</button>
            </div>
            <table class="data-table">
                <thead><tr><th>Rarity</th><th>Chance</th><th>Points</th><th>Sell</th></tr></thead>
                <tbody>
                    <tr><td><span class="rarity-badge common">Common</span></td><td>50%</td><td>10</td><td>$500</td></tr>
                    <tr><td><span class="rarity-badge uncommon">Uncommon</span></td><td>30%</td><td>25</td><td>$2K</td></tr>
                    <tr><td><span class="rarity-badge rare">Rare</span></td><td>12%</td><td>100</td><td>$10K</td></tr>
                    <tr><td><span class="rarity-badge epic">Epic</span></td><td>5%</td><td>500</td><td>$25K</td></tr>
                    <tr><td><span class="rarity-badge legendary">Legendary</span></td><td>2%</td><td>2.5K</td><td>$75K</td></tr>
                    <tr><td><span class="rarity-badge mythic">Mythic</span></td><td>0.8%</td><td>10K</td><td>$200K</td></tr>
                    <tr><td><span class="rarity-badge divine">Divine</span></td><td>0.2%</td><td>50K</td><td>$500K</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button class="modal-close" onclick="closeSettingsModal()">√ó</button>
            </div>
            <p style="color: var(--text-muted);">Settings coming soon...</p>
        </div>
    </div>

    <div id="packOpeningModal" class="hidden"></div>
    <div id="confetti" class="confetti"></div>
    <script>
        // ==================== CONFIGURATION ====================
        const SHEETS_URL = 'https://script.google.com/macros/s/AKfycbyHiqWKJD0tK3zIyHlUKaXhQKTGdfgdBZnE85x8gcQLXyhL7u2JpDFQDvm8A8EobMMMVQ/exec';
        
        // ==================== STATE ====================
        let currentUser = null;
        let selectedPack = null;
        let selectedRouletteColor = null;
        let crashRunning = false;
        let crashMultiplier = 1;
        let crashBetAmount = 0;
        let crashInterval = null;
        let bjDeck = [];
        let bjPlayerHand = [];
        let bjDealerHand = [];
        let bjBetAmount = 0;
        let bjGameActive = false;
        let plinkoActiveBalls = 0;
        let plinkoTotalWon = 0;
        
        // Cheat game state
        let cheatLobbyId = null;
        let cheatPollingInterval = null;
        let cheatGameState = null;
        let cheatSelectedCards = [];
        let cheatMyHand = [];

        // ==================== FIXED API CALL WITH CORS HANDLING ====================
        async function apiCall(action, params = {}) {
            const url = new URL(SHEETS_URL);
            url.searchParams.append('action', action);
            
            for (const [key, value] of Object.entries(params)) {
                if (value !== undefined && value !== null) {
                    url.searchParams.append(key, value);
                }
            }
            
            try {
                const response = await fetch(url.toString(), {
                    method: 'GET',
                    redirect: 'follow'
                });
                
                const text = await response.text();
                
                try {
                    return JSON.parse(text);
                } catch (e) {
                    console.error('JSON parse error:', e, 'Response:', text);
                    return { success: false, error: 'Invalid response from server' };
                }
            } catch (error) {
                console.error('API Error:', error);
                return { success: false, error: error.message };
            }
        }

        // ==================== UTILITIES ====================
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const msg = document.getElementById('toastMessage');
            
            toast.className = 'toast show ' + type;
            icon.textContent = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            msg.textContent = message;
            
            setTimeout(() => toast.classList.remove('show'), 4000);
        }

        function formatMoney(amount) {
            if (amount >= 1000000000) return '$' + (amount / 1000000000).toFixed(1) + 'B';
            if (amount >= 1000000) return '$' + (amount / 1000000).toFixed(1) + 'M';
            if (amount >= 1000) return '$' + (amount / 1000).toFixed(1) + 'K';
            return '$' + parseFloat(amount).toFixed(2);
        }

        function formatNumber(num) {
            return new Intl.NumberFormat().format(Math.floor(num));
        }

        // ==================== AUTH ====================
        function switchAuthTab(tab) {
            document.querySelectorAll('#authScreen .tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('loginTab').classList.toggle('hidden', tab !== 'login');
            document.getElementById('registerTab').classList.toggle('hidden', tab !== 'register');
        }

        async function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            showToast('Logging in...', 'info');
            const result = await apiCall('login', { email, password });
            
            if (result.success) {
                currentUser = result.user;
                localStorage.setItem('lintoriaUser', JSON.stringify(currentUser));
                showMainApp();
                showToast('Welcome back, ' + currentUser.name + '!', 'success');
            } else {
                showToast(result.error || 'Login failed', 'error');
            }
        }

        async function register() {
            const email = document.getElementById('registerEmail').value.trim();
            const name = document.getElementById('registerName').value.trim();
            const password = document.getElementById('registerPassword').value;
            
            if (!email || !name || !password) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            showToast('Creating account...', 'info');
            const result = await apiCall('register', { email, name, password });
            
            if (result.success) {
                currentUser = result.user;
                localStorage.setItem('lintoriaUser', JSON.stringify(currentUser));
                showMainApp();
                showToast('Welcome to Lintoria, ' + name + '!', 'success');
                createConfetti();
            } else {
                showToast(result.error || 'Registration failed', 'error');
            }
        }

        function logout() {
            stopCheatPolling();
            currentUser = null;
            localStorage.removeItem('lintoriaUser');
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('appScreen').classList.add('hidden');
            showToast('Logged out', 'info');
        }

        function showMainApp() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('appScreen').classList.remove('hidden');
            document.getElementById('userName').textContent = currentUser.name;
            
            if (currentUser.isAdmin) {
                document.getElementById('adminTab').style.display = 'flex';
                document.getElementById('stockAdminPanel').style.display = 'block';
            }
            
            updateBalance();
            loadDashboard();
            initPlinko();
            initRoulette();
        }

        // ==================== DASHBOARD ====================
        async function updateBalance() {
            const result = await apiCall('getBalance', { email: currentUser.email });
            if (result.success) {
                currentUser.balance = result.balance;
                document.getElementById('balanceAmount').textContent = formatNumber(result.balance);
            }
        }

        async function loadDashboard() {
            await updateBalance();
            loadStats();
            loadTransactions();
        }

        async function loadStats() {
            const result = await apiCall('getStats', { email: currentUser.email });
            if (result.success) {
                document.getElementById('creditScoreDisplay').textContent = result.creditScore || 650;
                document.getElementById('loanCreditScore').textContent = result.creditScore || 650;
                document.getElementById('emojiScoreDisplay').textContent = formatNumber(result.emojiScore || 0);
                document.getElementById('emojiScoreHeader').textContent = formatNumber(result.emojiScore || 0) + ' pts';
                document.getElementById('totalWageredDisplay').textContent = formatMoney(result.totalWagered || 0);
                document.getElementById('netGamblingDisplay').textContent = formatMoney(result.netGambling || 0);
                
                const maxLoan = Math.floor((result.creditScore || 650) * 100);
                document.getElementById('maxLoanAmount').textContent = formatMoney(maxLoan);
            }
        }

        async function loadTransactions() {
            const result = await apiCall('getTransactions', { email: currentUser.email });
            const container = document.getElementById('transactionsList');
            
            if (result.success && result.transactions && result.transactions.length > 0) {
                container.innerHTML = result.transactions.slice(0, 15).map(t => `
                    <div class="transaction-item">
                        <div>
                            <div style="font-weight: 600;">${t.type}</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">${t.description || ''}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: ${t.amount >= 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: 700;">
                                ${t.amount >= 0 ? '+' : ''}${formatMoney(t.amount)}
                            </div>
                            <div style="font-size: 0.7rem; color: var(--text-muted);">${new Date(t.date).toLocaleDateString()}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">üìú</div><p>No transactions yet</p></div>';
            }
        }

        // ==================== TABS ====================
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById(tab + 'Content').classList.remove('hidden');
            
            if (tab === 'dashboard') loadDashboard();
            else if (tab === 'packs') loadPacks();
            else if (tab === 'collection') loadCollection();
            else if (tab === 'leaderboard') loadLeaderboards();
            else if (tab === 'chat') loadChat();
            else if (tab === 'stocks') loadStocks();
            else if (tab === 'loans') loadLoans();
            else if (tab === 'admin') loadAdminUsers();
            else if (tab === 'casino') initCheatLobby();
        }

        // ==================== TRANSFER ====================
        async function transferMoney() {
            const recipient = document.getElementById('recipientEmail').value.trim();
            const amount = parseFloat(document.getElementById('transferAmount').value);
            const note = document.getElementById('transferNote').value.trim();
            
            if (!recipient || !amount || amount <= 0) {
                showToast('Please fill in recipient and amount', 'error');
                return;
            }
            
            if (amount > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }
            
            const result = await apiCall('transfer', {
                from: currentUser.email,
                to: recipient,
                amount: amount,
                note: note
            });
            
            if (result.success) {
                showToast('Sent ' + formatMoney(amount) + ' to ' + recipient, 'success');
                document.getElementById('recipientEmail').value = '';
                document.getElementById('transferAmount').value = '';
                document.getElementById('transferNote').value = '';
                updateBalance();
            } else {
                showToast(result.error || 'Transfer failed', 'error');
            }
        }

        // ==================== LOANS ====================
        async function loadLoans() {
            await loadStats();
            const result = await apiCall('getLoans', { email: currentUser.email });
            const container = document.getElementById('activeLoansList');
            
            if (result.success && result.loans && result.loans.length > 0) {
                container.innerHTML = result.loans.map(loan => {
                    const isOverdue = new Date(loan.dueDate) < new Date();
                    return `
                        <div class="loan-card ${isOverdue ? 'overdue' : ''}">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="font-weight: 700; color: var(--gold);">Loan #${loan.id}</span>
                                <span style="color: ${isOverdue ? 'var(--danger)' : 'var(--text-muted)'};">
                                    ${isOverdue ? '‚ö†Ô∏è OVERDUE' : 'Due: ' + new Date(loan.dueDate).toLocaleDateString()}
                                </span>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.85rem;">
                                <div>Principal: ${formatMoney(loan.principal)}</div>
                                <div>Interest: ${formatMoney(loan.interest)}</div>
                                <div>Total Due: <strong style="color: var(--gold);">${formatMoney(loan.totalDue)}</strong></div>
                                <div>Rate: ${loan.rate}%</div>
                            </div>
                            <button class="btn btn-success btn-sm" onclick="repayLoan('${loan.id}')" style="width: 100%; margin-top: 0.75rem;">
                                üí∞ Repay ${formatMoney(loan.totalDue)}
                            </button>
                        </div>
                    `;
                }).join('');
            } else {
                container.innerHTML = '<div class="empty-state"><p>No active loans</p></div>';
            }
        }

        async function applyForLoan() {
            const amount = parseFloat(document.getElementById('loanAmount').value);
            const term = parseInt(document.getElementById('loanTerm').value);
            
            if (!amount || amount < 1000) {
                showToast('Minimum loan amount is $1,000', 'error');
                return;
            }
            
            const result = await apiCall('applyLoan', {
                email: currentUser.email,
                amount: amount,
                term: term
            });
            
            if (result.success) {
                showToast('Loan approved! ' + formatMoney(amount) + ' credited', 'success');
                document.getElementById('loanAmount').value = '';
                updateBalance();
                loadLoans();
            } else {
                showToast(result.error || 'Loan denied', 'error');
            }
        }

        async function repayLoan(loanId) {
            const result = await apiCall('repayLoan', {
                email: currentUser.email,
                loanId: loanId
            });
            
            if (result.success) {
                showToast('Loan repaid!', 'success');
                updateBalance();
                loadLoans();
                loadStats();
            } else {
                showToast(result.error || 'Repayment failed', 'error');
            }
        }

        // ==================== STOCKS ====================
        async function loadStocks() {
            const result = await apiCall('getStocks');
            const container = document.getElementById('stocksList');
            
            if (result.success && result.stocks && result.stocks.length > 0) {
                container.innerHTML = result.stocks.map(stock => `
                    <div class="stock-card ${stock.change >= 0 ? 'up' : 'down'}">
                        <div class="stock-symbol">${stock.symbol}</div>
                        <div class="stock-name">${stock.name}</div>
                        <div class="stock-price">${formatMoney(stock.price)}</div>
                        <div class="stock-change ${stock.change >= 0 ? 'up' : 'down'}">
                            ${stock.change >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(stock.change).toFixed(2)}%
                        </div>
                        <div class="stock-actions">
                            <input type="number" id="qty-${stock.symbol}" placeholder="Qty" min="1" value="1">
                            <button class="btn btn-sm btn-success" onclick="buyStock('${stock.symbol}', ${stock.price})">Buy</button>
                            <button class="btn btn-sm btn-danger" onclick="sellStock('${stock.symbol}', ${stock.price})">Sell</button>
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<div class="empty-state"><p>No stocks available</p></div>';
            }
            
            loadHoldings();
        }

        async function loadHoldings() {
            const result = await apiCall('getHoldings', { email: currentUser.email });
            const container = document.getElementById('holdingsList');
            
            if (result.success && result.holdings && result.holdings.length > 0) {
                container.innerHTML = result.holdings.map(h => `
                    <div class="holding-card">
                        <div style="font-weight: 700; color: var(--gold);">${h.symbol}</div>
                        <div style="font-size: 0.85rem;">${h.shares} shares</div>
                        <div style="font-size: 0.85rem;">Avg: ${formatMoney(h.avgPrice)}</div>
                        <div style="font-size: 0.85rem; color: ${h.profit >= 0 ? 'var(--success)' : 'var(--danger)'};">
                            P/L: ${h.profit >= 0 ? '+' : ''}${formatMoney(h.profit)}
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<div class="empty-state"><p>No holdings</p></div>';
            }
        }

        async function buyStock(symbol, price) {
            const qty = parseInt(document.getElementById('qty-' + symbol).value) || 1;
            const total = price * qty;
            
            if (total > currentUser.balance) {
                showToast('Insufficient funds', 'error');
                return;
            }
            
            const result = await apiCall('buyStock', {
                email: currentUser.email,
                symbol: symbol,
                qty: qty,
                price: price
            });
            
            if (result.success) {
                showToast('Bought ' + qty + ' ' + symbol + ' for ' + formatMoney(total), 'success');
                updateBalance();
                loadStocks();
            } else {
                showToast(result.error || 'Purchase failed', 'error');
            }
        }

        async function sellStock(symbol, price) {
            const qty = parseInt(document.getElementById('qty-' + symbol).value) || 1;
            
            const result = await apiCall('sellStock', {
                email: currentUser.email,
                symbol: symbol,
                qty: qty,
                price: price
            });
            
            if (result.success) {
                showToast('Sold ' + qty + ' ' + symbol + ' for ' + formatMoney(price * qty), 'success');
                updateBalance();
                loadStocks();
            } else {
                showToast(result.error || 'Sale failed', 'error');
            }
        }

        async function createNewStock() {
            const symbol = document.getElementById('newStockSymbol').value.trim().toUpperCase();
            const name = document.getElementById('newStockName').value.trim();
            const price = parseFloat(document.getElementById('newStockPrice').value);
            const shares = parseInt(document.getElementById('newStockShares').value);
            
            if (!symbol || !name || !price) {
                showToast('Fill in all stock fields', 'error');
                return;
            }
            
            const result = await apiCall('createStock', {
                email: currentUser.email,
                symbol, name, price, shares
            });
            
            if (result.success) {
                showToast('Created ' + symbol, 'success');
                loadStocks();
            } else {
                showToast(result.error || 'Failed to create stock', 'error');
            }
        }

        async function removeStock() {
            const symbol = document.getElementById('newStockSymbol').value.trim().toUpperCase();
            if (!symbol) {
                showToast('Enter symbol to remove', 'error');
                return;
            }
            
            const result = await apiCall('removeStock', {
                email: currentUser.email,
                symbol: symbol
            });
            
            if (result.success) {
                showToast('Removed ' + symbol, 'success');
                loadStocks();
            } else {
                showToast(result.error || 'Failed', 'error');
            }
        }
        // ==================== EMOJI PACKS ====================
        const PACKS = [
            { id: 'nature', name: 'üåø Nature', emojis: ['üå∏', 'üå∫', 'üåª', 'üå∑', 'üåπ', 'üçÄ', 'üå¥', 'üåµ', 'üçÅ', 'üåä'] },
            { id: 'animals', name: 'üêæ Animals', emojis: ['üê∂', 'üê±', 'ü¶ä', 'üêº', 'ü¶Å', 'üêØ', 'üêª', 'üê®', 'üêµ', 'ü¶Ñ'] },
            { id: 'food', name: 'üçî Food', emojis: ['üçï', 'üçü', 'üåÆ', 'üç£', 'üç∞', 'üç©', 'üç™', 'üßÅ', 'üç´', 'üçø'] },
            { id: 'sports', name: '‚öΩ Sports', emojis: ['‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'üéæ', 'üèê', 'üé±', 'üèì', 'üè∏', 'ü•ä'] },
            { id: 'space', name: 'üöÄ Space', emojis: ['üöÄ', 'üõ∏', 'üåô', '‚≠ê', 'üåü', 'üí´', '‚òÑÔ∏è', 'üåç', 'ü™ê', 'üåå'] },
            { id: 'fantasy', name: 'üêâ Fantasy', emojis: ['üêâ', 'ü¶ã', 'üßö', 'üßô', 'üëª', 'üëΩ', 'ü§ñ', 'üíÄ', 'üéÉ', 'üîÆ'] },
            { id: 'wealth', name: 'üíé Wealth', emojis: ['üíé', 'üí∞', 'üèÜ', 'üëë', 'üíµ', 'ü™ô', 'üí≥', 'üé∞', 'üé≤', 'üÉè'] },
            { id: 'hearts', name: '‚ù§Ô∏è Hearts', emojis: ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç', 'üíù', 'üíñ'] }
        ];

        const RARITIES = [
            { name: 'common', chance: 0.50, points: 10, sellPrice: 500, color: '#9ca3af' },
            { name: 'uncommon', chance: 0.30, points: 25, sellPrice: 2000, color: '#22c55e' },
            { name: 'rare', chance: 0.12, points: 100, sellPrice: 10000, color: '#3b82f6' },
            { name: 'epic', chance: 0.05, points: 500, sellPrice: 25000, color: '#a855f7' },
            { name: 'legendary', chance: 0.02, points: 2500, sellPrice: 75000, color: '#fbbf24' },
            { name: 'mythic', chance: 0.008, points: 10000, sellPrice: 200000, color: '#ec4899' },
            { name: 'divine', chance: 0.002, points: 50000, sellPrice: 500000, color: '#06b6d4' }
        ];

        function loadPacks() {
            const container = document.getElementById('packsList');
            container.innerHTML = PACKS.map(pack => `
                <div class="pack-card ${selectedPack === pack.id ? 'selected' : ''}" onclick="selectPack('${pack.id}')">
                    <div class="pack-name">${pack.name}</div>
                    <div class="pack-emojis">${pack.emojis.slice(0, 5).join('')}</div>
                </div>
            `).join('');
        }

        function selectPack(packId) {
            selectedPack = packId;
            const pack = PACKS.find(p => p.id === packId);
            document.getElementById('selectedPackName').textContent = pack.name + ' selected';
            document.getElementById('buyPackBtn').disabled = false;
            loadPacks();
        }

        async function buyPack() {
            if (!selectedPack) {
                showToast('Select a pack first', 'error');
                return;
            }
            
            if (currentUser.balance < 7500) {
                showToast('Need $7,500 for a pack', 'error');
                return;
            }
            
            const pack = PACKS.find(p => p.id === selectedPack);
            const emoji = pack.emojis[Math.floor(Math.random() * pack.emojis.length)];
            const rarity = getRarity();
            
            // FIXED: Encode emoji for URL transmission
            const result = await apiCall('buyPack', {
                email: currentUser.email,
                packId: selectedPack,
                emoji: encodeURIComponent(emoji),
                rarity: rarity.name,
                points: rarity.points
            });
            
            if (result.success) {
                showPackOpening(emoji, rarity);
                updateBalance();
                loadStats();
            } else {
                showToast(result.error || 'Failed to open pack', 'error');
            }
        }

        function getRarity() {
            const rand = Math.random();
            let cumulative = 0;
            for (const rarity of RARITIES) {
                cumulative += rarity.chance;
                if (rand < cumulative) return rarity;
            }
            return RARITIES[0];
        }

        function showPackOpening(emoji, rarity) {
            const modal = document.getElementById('packOpeningModal');
            modal.className = 'pack-opening';
            modal.innerHTML = `
                <div class="pack-reveal" style="filter: drop-shadow(0 0 30px ${rarity.color});">${emoji}</div>
                <div class="pack-rarity-text" style="color: ${rarity.color};">${rarity.name.toUpperCase()}</div>
                <div style="color: var(--gold); margin-top: 1rem; font-size: 1.2rem;">+${formatNumber(rarity.points)} points</div>
                <button class="btn btn-success" onclick="closePackOpening()" style="margin-top: 2rem;">Continue</button>
            `;
            
            if (rarity.name === 'legendary' || rarity.name === 'mythic' || rarity.name === 'divine') {
                createConfetti();
            }
        }

        function closePackOpening() {
            document.getElementById('packOpeningModal').className = 'hidden';
        }

        // ==================== COLLECTION ====================
        async function loadCollection() {
            const result = await apiCall('getCollection', { email: currentUser.email });
            const container = document.getElementById('emojiCollection');
            
            if (result.success && result.collection && result.collection.length > 0) {
                container.innerHTML = result.collection.map(item => {
                    const rarity = RARITIES.find(r => r.name === item.rarity) || RARITIES[0];
                    return `
                        <div class="emoji-card ${item.rarity}" onclick="sellEmoji('${encodeURIComponent(item.emoji)}', '${item.rarity}')">
                            <span class="emoji">${item.emoji}</span>
                            <span class="rarity-badge ${item.rarity}">${item.rarity}</span>
                        </div>
                    `;
                }).join('');
            } else {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">üéí</div><p>No emojis yet. Buy packs to collect!</p></div>';
            }
        }

        async function sellEmoji(encodedEmoji, rarity) {
            const rarityData = RARITIES.find(r => r.name === rarity);
            if (!confirm(`Sell this ${rarity} emoji for ${formatMoney(rarityData.sellPrice)}?`)) return;
            
            // encodedEmoji is already encoded from the onclick
            const result = await apiCall('sellEmoji', {
                email: currentUser.email,
                emoji: encodedEmoji,
                rarity: rarity,
                price: rarityData.sellPrice
            });
            
            if (result.success) {
                showToast('Sold for ' + formatMoney(rarityData.sellPrice), 'success');
                updateBalance();
                loadCollection();
                loadStats();
            } else {
                showToast(result.error || 'Failed to sell', 'error');
            }
        }

        // ==================== PLINKO ====================
        function initPlinko() {
            const board = document.getElementById('plinkoBoard');
            board.innerHTML = '';
            
            const rows = 12;
            const boardWidth = board.offsetWidth || 476;
            const boardHeight = 420;
            const pegSpacingX = boardWidth / 14;
            const pegSpacingY = (boardHeight - 60) / (rows + 1);
            
            for (let row = 0; row < rows; row++) {
                const pegsInRow = row + 3;
                const rowWidth = (pegsInRow - 1) * pegSpacingX;
                const startX = (boardWidth - rowWidth) / 2;
                
                for (let col = 0; col < pegsInRow; col++) {
                    const peg = document.createElement('div');
                    peg.className = 'plinko-peg';
                    peg.style.left = (startX + col * pegSpacingX) + 'px';
                    peg.style.top = (30 + row * pegSpacingY) + 'px';
                    board.appendChild(peg);
                }
            }
            
            const slots = document.createElement('div');
            slots.className = 'plinko-slots';
            const multipliers = ['0.2', '0.5', '1', '1.5', '2', '5', '2', '1.5', '1', '0.5', '0.2'];
            multipliers.forEach(mult => {
                const slot = document.createElement('div');
                slot.className = 'plinko-slot';
                slot.setAttribute('data-mult', mult);
                slot.textContent = mult + 'x';
                slots.appendChild(slot);
            });
            board.appendChild(slots);
        }

        async function dropPlinkoBall() {
            const bet = parseFloat(document.getElementById('plinkoBet').value);
            if (!bet || bet <= 0) {
                showToast('Enter a bet amount', 'error');
                return;
            }
            if (bet > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }
            
            currentUser.balance -= bet;
            document.getElementById('balanceAmount').textContent = formatNumber(currentUser.balance);
            
            plinkoActiveBalls++;
            document.getElementById('plinkoBallCount').textContent = plinkoActiveBalls;
            
            const board = document.getElementById('plinkoBoard');
            const ball = document.createElement('div');
            const colors = ['ball-red', 'ball-blue', 'ball-green', 'ball-purple', 'ball-orange'];
            ball.className = 'plinko-ball ' + colors[Math.floor(Math.random() * colors.length)];
            
            const boardWidth = board.offsetWidth || 476;
            let x = boardWidth / 2 + (Math.random() - 0.5) * 40;
            let y = 10;
            let vx = 0;
            let vy = 0;
            
            ball.style.left = x + 'px';
            ball.style.top = y + 'px';
            board.appendChild(ball);
            
            const gravity = 0.35;
            const bounce = 0.7;
            const friction = 0.99;
            const pegRadius = 5;
            const ballRadius = 9;
            const rows = 12;
            const pegSpacingX = boardWidth / 14;
            const pegSpacingY = (420 - 60) / (rows + 1);
            
            const pegs = [];
            for (let row = 0; row < rows; row++) {
                const pegsInRow = row + 3;
                const rowWidth = (pegsInRow - 1) * pegSpacingX;
                const startX = (boardWidth - rowWidth) / 2;
                for (let col = 0; col < pegsInRow; col++) {
                    pegs.push({
                        x: startX + col * pegSpacingX,
                        y: 30 + row * pegSpacingY
                    });
                }
            }
            
            const multipliers = [0.2, 0.5, 1, 1.5, 2, 5, 2, 1.5, 1, 0.5, 0.2];
            const slotWidth = 30;
            const slotsStartX = (boardWidth - multipliers.length * slotWidth) / 2;
            
            function animate() {
                vy += gravity;
                vx *= friction;
                x += vx;
                y += vy;
                
                for (const peg of pegs) {
                    const dx = x - peg.x;
                    const dy = y - peg.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const minDist = pegRadius + ballRadius;
                    
                    if (dist < minDist && dist > 0) {
                        const nx = dx / dist;
                        const ny = dy / dist;
                        const overlap = minDist - dist;
                        
                        x += nx * overlap;
                        y += ny * overlap;
                        
                        const dot = vx * nx + vy * ny;
                        vx = (vx - 2 * dot * nx) * bounce + (Math.random() - 0.5) * 2;
                        vy = (vy - 2 * dot * ny) * bounce;
                    }
                }
                
                if (x < ballRadius) { x = ballRadius; vx = -vx * bounce; }
                if (x > boardWidth - ballRadius) { x = boardWidth - ballRadius; vx = -vx * bounce; }
                
                ball.style.left = x + 'px';
                ball.style.top = y + 'px';
                
                if (y >= 378) {
                    let slotIndex = Math.floor((x - slotsStartX) / slotWidth);
                    slotIndex = Math.max(0, Math.min(multipliers.length - 1, slotIndex));
                    const mult = multipliers[slotIndex];
                    const winAmount = bet * mult;
                    
                    const slots = document.querySelectorAll('.plinko-slot');
                    slots[slotIndex].classList.add('active');
                    setTimeout(() => slots[slotIndex].classList.remove('active'), 500);
                    
                    plinkoTotalWon += winAmount;
                    document.getElementById('plinkoTotalWon').textContent = formatMoney(plinkoTotalWon);
                    
                    recordPlinkoResult(bet, mult, winAmount);
                    
                    plinkoActiveBalls--;
                    document.getElementById('plinkoBallCount').textContent = plinkoActiveBalls;
                    
                    setTimeout(() => ball.remove(), 300);
                    return;
                }
                
                requestAnimationFrame(animate);
            }
            
            animate();
        }

        async function recordPlinkoResult(bet, mult, winAmount) {
            const result = await apiCall('gamble', {
                email: currentUser.email,
                game: 'plinko',
                bet: bet,
                outcome: mult >= 1 ? 'win' : 'lose',
                amount: winAmount - bet
            });
            
            if (result.success) {
                currentUser.balance = result.balance;
                document.getElementById('balanceAmount').textContent = formatNumber(result.balance);
                
                const resultText = mult >= 1 
                    ? `üéâ ${mult}x ‚Üí +${formatMoney(winAmount - bet)}`
                    : `${mult}x ‚Üí -${formatMoney(bet - winAmount)}`;
                document.getElementById('plinkoResult').innerHTML = `<span style="color: ${mult >= 1 ? 'var(--success)' : 'var(--danger)'}">${resultText}</span>`;
            }
        }

        // ==================== ROULETTE ====================
        function initRoulette() {
            const wheel = document.getElementById('rouletteWheel');
            wheel.innerHTML = '';
            
            const segments = [
                { num: 0, color: '#16a34a' },
                { num: 32, color: '#dc2626' }, { num: 15, color: '#1f2937' },
                { num: 19, color: '#dc2626' }, { num: 4, color: '#1f2937' },
                { num: 21, color: '#dc2626' }, { num: 2, color: '#1f2937' },
                { num: 25, color: '#dc2626' }, { num: 17, color: '#1f2937' },
                { num: 34, color: '#dc2626' }, { num: 6, color: '#1f2937' },
                { num: 27, color: '#dc2626' }, { num: 13, color: '#1f2937' },
                { num: 36, color: '#dc2626' }, { num: 11, color: '#1f2937' },
                { num: 30, color: '#dc2626' }, { num: 8, color: '#1f2937' },
                { num: 23, color: '#dc2626' }, { num: 10, color: '#1f2937' },
                { num: 5, color: '#dc2626' }, { num: 24, color: '#1f2937' },
                { num: 16, color: '#dc2626' }, { num: 33, color: '#1f2937' },
                { num: 1, color: '#dc2626' }, { num: 20, color: '#1f2937' },
                { num: 14, color: '#dc2626' }, { num: 31, color: '#1f2937' },
                { num: 9, color: '#dc2626' }, { num: 22, color: '#1f2937' },
                { num: 18, color: '#dc2626' }, { num: 29, color: '#1f2937' },
                { num: 7, color: '#dc2626' }, { num: 28, color: '#1f2937' },
                { num: 12, color: '#dc2626' }, { num: 35, color: '#1f2937' },
                { num: 3, color: '#dc2626' }, { num: 26, color: '#1f2937' }
            ];
            
            const segmentAngle = 360 / segments.length;
            
            segments.forEach((seg, i) => {
                const div = document.createElement('div');
                div.className = 'roulette-segment';
                div.style.background = seg.color;
                div.style.transform = `rotate(${i * segmentAngle - 90}deg) skewY(${90 - segmentAngle}deg)`;
                div.innerHTML = `<span>${seg.num}</span>`;
                wheel.appendChild(div);
            });
        }

        function selectRouletteBet(color) {
            selectedRouletteColor = color;
            document.querySelectorAll('.roulette-bet-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('bet' + color.charAt(0).toUpperCase() + color.slice(1)).classList.add('selected');
            document.getElementById('rouletteBtn').disabled = false;
        }

        async function playRoulette() {
            if (!selectedRouletteColor) {
                showToast('Select red, black, or green', 'error');
                return;
            }
            
            const bet = parseFloat(document.getElementById('rouletteBet').value);
            if (!bet || bet <= 0) {
                showToast('Enter a bet amount', 'error');
                return;
            }
            if (bet > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }
            
            document.getElementById('rouletteBtn').disabled = true;
            
            const redNumbers = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
            const result = Math.floor(Math.random() * 37);
            const isRed = redNumbers.includes(result);
            const isGreen = result === 0;
            const resultColor = isGreen ? 'green' : (isRed ? 'red' : 'black');
            
            const wheel = document.getElementById('rouletteWheel');
            const spins = 5 + Math.random() * 3;
            const segmentAngle = 360 / 37;
            const targetAngle = spins * 360 + (37 - result) * segmentAngle;
            
            wheel.style.transition = 'transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)';
            wheel.style.transform = `rotate(${targetAngle}deg)`;
            
            setTimeout(async () => {
                wheel.style.transition = 'none';
                wheel.style.transform = `rotate(${targetAngle % 360}deg)`;
                
                const won = selectedRouletteColor === resultColor;
                const multiplier = resultColor === 'green' ? 14 : 1.8;
                const winAmount = won ? bet * multiplier : 0;
                const netAmount = winAmount - bet;
                
                const apiResult = await apiCall('gamble', {
                    email: currentUser.email,
                    game: 'roulette',
                    bet: bet,
                    outcome: won ? 'win' : 'lose',
                    amount: netAmount
                });
                
                if (apiResult.success) {
                    currentUser.balance = apiResult.balance;
                    document.getElementById('balanceAmount').textContent = formatNumber(apiResult.balance);
                    
                    const colorEmoji = resultColor === 'red' ? 'üî¥' : (resultColor === 'black' ? '‚ö´' : 'üü¢');
                    document.getElementById('rouletteResult').innerHTML = won
                        ? `<span style="color: var(--success);">${colorEmoji} ${result} - Won ${formatMoney(winAmount)}!</span>`
                        : `<span style="color: var(--danger);">${colorEmoji} ${result} - Lost ${formatMoney(bet)}</span>`;
                }
                
                document.getElementById('rouletteBtn').disabled = false;
            }, 4000);
        }

        // ==================== SLOTS ====================
        const SLOT_SYMBOLS = ['üçí', 'üçã', 'üçä', 'üçá', 'üíé', '7Ô∏è‚É£', 'üîî'];
        const SLOT_PAYOUTS = {
            'üçíüçíüçí': 3,
            'üçãüçãüçã': 4,
            'üçäüçäüçä': 5,
            'üçáüçáüçá': 8,
            'üîîüîîüîî': 10,
            'üíéüíéüíé': 15,
            '7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£': 25
        };

        async function playSlots() {
            const bet = parseFloat(document.getElementById('slotsBet').value);
            if (!bet || bet <= 0) {
                showToast('Enter a bet amount', 'error');
                return;
            }
            if (bet > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }
            
            const reels = [
                document.getElementById('reel1'),
                document.getElementById('reel2'),
                document.getElementById('reel3')
            ];
            
            reels.forEach(reel => reel.classList.add('spinning'));
            
            const results = [];
            const delays = [800, 1200, 1600];
            
            for (let i = 0; i < 3; i++) {
                await new Promise(resolve => setTimeout(resolve, delays[i] - (i > 0 ? delays[i-1] : 0)));
                results[i] = SLOT_SYMBOLS[Math.floor(Math.random() * SLOT_SYMBOLS.length)];
                reels[i].classList.remove('spinning');
                reels[i].querySelector('.slot-symbol').textContent = results[i];
            }
            
            await new Promise(resolve => setTimeout(resolve, 400));
            
            const combo = results.join('');
            const multiplier = SLOT_PAYOUTS[combo] || (results[0] === results[1] || results[1] === results[2] ? 1.5 : 0);
            const winAmount = bet * multiplier;
            const netAmount = winAmount - bet;
            
            const result = await apiCall('gamble', {
                email: currentUser.email,
                game: 'slots',
                bet: bet,
                outcome: multiplier > 0 ? 'win' : 'lose',
                amount: netAmount
            });
            
            if (result.success) {
                currentUser.balance = result.balance;
                document.getElementById('balanceAmount').textContent = formatNumber(result.balance);
                
                document.getElementById('slotsResult').innerHTML = multiplier > 0
                    ? `<span style="color: var(--success);">üéâ ${multiplier}x ‚Üí +${formatMoney(winAmount)}</span>`
                    : `<span style="color: var(--danger);">No match - Lost ${formatMoney(bet)}</span>`;
                
                if (multiplier >= 10) createConfetti();
            }
        }

        // ==================== COIN FLIP ====================
        async function playCoinFlip(choice) {
            const bet = parseFloat(document.getElementById('coinBet').value);
            if (!bet || bet <= 0) {
                showToast('Enter a bet amount', 'error');
                return;
            }
            if (bet > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }
            
            const coin = document.getElementById('coin');
            coin.classList.add('flipping');
            
            setTimeout(async () => {
                coin.classList.remove('flipping');
                
                const result = Math.random() < 0.45 ? choice : (choice === 'heads' ? 'tails' : 'heads');
                const won = result === choice;
                const winAmount = won ? bet * 1.9 : 0;
                const netAmount = winAmount - bet;
                
                coin.style.transform = result === 'heads' ? 'rotateY(0)' : 'rotateY(180deg)';
                
                const apiResult = await apiCall('gamble', {
                    email: currentUser.email,
                    game: 'coinflip',
                    bet: bet,
                    outcome: won ? 'win' : 'lose',
                    amount: netAmount
                });
                
                if (apiResult.success) {
                    currentUser.balance = apiResult.balance;
                    document.getElementById('balanceAmount').textContent = formatNumber(apiResult.balance);
                    
                    document.getElementById('coinResult').innerHTML = won
                        ? `<span style="color: var(--success);">üéâ ${result.toUpperCase()} - Won ${formatMoney(winAmount)}!</span>`
                        : `<span style="color: var(--danger);">${result.toUpperCase()} - Lost ${formatMoney(bet)}</span>`;
                }
            }, 1500);
        }

        // ==================== DICE ====================
        const DICE_FACES = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];

        async function playDice() {
            const bet = parseFloat(document.getElementById('diceBet').value);
            if (!bet || bet <= 0) {
                showToast('Enter a bet amount', 'error');
                return;
            }
            if (bet > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }
            
            const dice = document.getElementById('dice');
            dice.classList.add('rolling');
            
            setTimeout(async () => {
                dice.classList.remove('rolling');
                
                const roll = Math.floor(Math.random() * 6) + 1;
                const won = roll >= 4;
                const winAmount = won ? bet * 1.9 : 0;
                const netAmount = winAmount - bet;
                
                const rotations = {
                    1: 'rotateX(0) rotateY(0)',
                    2: 'rotateX(-90deg) rotateY(0)',
                    3: 'rotateY(90deg)',
                    4: 'rotateY(-90deg)',
                    5: 'rotateX(90deg)',
                    6: 'rotateX(180deg)'
                };
                dice.style.transform = rotations[roll];
                
                const result = await apiCall('gamble', {
                    email: currentUser.email,
                    game: 'dice',
                    bet: bet,
                    outcome: won ? 'win' : 'lose',
                    amount: netAmount
                });
                
                if (result.success) {
                    currentUser.balance = result.balance;
                    document.getElementById('balanceAmount').textContent = formatNumber(result.balance);
                    
                    document.getElementById('diceResult').innerHTML = won
                        ? `<span style="color: var(--success);">üé≤ Rolled ${roll} - Won ${formatMoney(winAmount)}!</span>`
                        : `<span style="color: var(--danger);">üé≤ Rolled ${roll} - Lost ${formatMoney(bet)}</span>`;
                }
            }, 1000);
        }

        // ==================== CRASH ====================
        async function startCrash() {
            const bet = parseFloat(document.getElementById('crashBet').value);
            if (!bet || bet <= 0) {
                showToast('Enter a bet amount', 'error');
                return;
            }
            if (bet > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }
            
            crashBetAmount = bet;
            currentUser.balance -= bet;
            document.getElementById('balanceAmount').textContent = formatNumber(currentUser.balance);
            
            crashRunning = true;
            crashMultiplier = 1;
            document.getElementById('crashStartBtn').disabled = true;
            document.getElementById('crashCashoutBtn').disabled = false;
            document.getElementById('crashStatus').textContent = 'Running...';
            document.getElementById('crashResult').innerHTML = '';
            
            const crashPoint = 1 + (Math.random() * Math.random() * 10);
            
            crashInterval = setInterval(() => {
                if (!crashRunning) return;
                
                crashMultiplier += 0.02;
                document.getElementById('crashMultiplier').textContent = crashMultiplier.toFixed(2) + 'x';
                document.getElementById('crashMultiplier').classList.remove('crashed');
                
                if (crashMultiplier >= crashPoint) {
                    crashGame(false, crashPoint);
                }
            }, 100);
        }

        async function cashoutCrash() {
            if (!crashRunning) return;
            crashGame(true, crashMultiplier);
        }

        async function crashGame(cashedOut, finalMult) {
            crashRunning = false;
            clearInterval(crashInterval);
            
            document.getElementById('crashStartBtn').disabled = false;
            document.getElementById('crashCashoutBtn').disabled = true;
            
            if (cashedOut) {
                const winAmount = crashBetAmount * finalMult;
                const netAmount = winAmount - crashBetAmount;
                
                const result = await apiCall('gamble', {
                    email: currentUser.email,
                    game: 'crash',
                    bet: crashBetAmount,
                    outcome: 'win',
                    amount: netAmount
                });
                
                if (result.success) {
                    currentUser.balance = result.balance;
                    document.getElementById('balanceAmount').textContent = formatNumber(result.balance);
                }
                
                document.getElementById('crashStatus').textContent = 'Cashed out!';
                document.getElementById('crashResult').innerHTML = `<span style="color: var(--success);">üí∞ ${finalMult.toFixed(2)}x ‚Üí +${formatMoney(winAmount)}</span>`;
                
                if (finalMult >= 5) createConfetti();
            } else {
                document.getElementById('crashMultiplier').textContent = finalMult.toFixed(2) + 'x';
                document.getElementById('crashMultiplier').classList.add('crashed');
                document.getElementById('crashStatus').textContent = 'üí• CRASHED!';
                document.getElementById('crashResult').innerHTML = `<span style="color: var(--danger);">Crashed at ${finalMult.toFixed(2)}x - Lost ${formatMoney(crashBetAmount)}</span>`;
                
                await apiCall('gamble', {
                    email: currentUser.email,
                    game: 'crash',
                    bet: crashBetAmount,
                    outcome: 'lose',
                    amount: -crashBetAmount
                });
            }
        }
        // ==================== BLACKJACK ====================
        function createDeck() {
            const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
            const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
            const deck = [];
            for (const suit of suits) {
                for (const value of values) {
                    deck.push({ suit, value, isRed: suit === '‚ô•' || suit === '‚ô¶' });
                }
            }
            return deck.sort(() => Math.random() - 0.5);
        }

        function getCardValue(card) {
            if (['J', 'Q', 'K'].includes(card.value)) return 10;
            if (card.value === 'A') return 11;
            return parseInt(card.value);
        }

        function getHandValue(hand) {
            let value = 0;
            let aces = 0;
            for (const card of hand) {
                value += getCardValue(card);
                if (card.value === 'A') aces++;
            }
            while (value > 21 && aces > 0) {
                value -= 10;
                aces--;
            }
            return value;
        }

        function renderCards(cards, containerId, hideFirst = false) {
            const container = document.getElementById(containerId);
            container.innerHTML = cards.map((card, i) => {
                if (hideFirst && i === 0) {
                    return `<div class="bj-card hidden"></div>`;
                }
                return `<div class="bj-card ${card.isRed ? 'red' : 'black'}">
                    <div>${card.value}</div>
                    <div>${card.suit}</div>
                </div>`;
            }).join('');
        }

        async function startBlackjack() {
            const bet = parseFloat(document.getElementById('bjBet').value);
            if (!bet || bet <= 0) {
                showToast('Enter a bet amount', 'error');
                return;
            }
            if (bet > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }
            
            bjBetAmount = bet;
            bjGameActive = true;
            bjDeck = createDeck();
            bjPlayerHand = [bjDeck.pop(), bjDeck.pop()];
            bjDealerHand = [bjDeck.pop(), bjDeck.pop()];
            
            renderCards(bjPlayerHand, 'playerCards');
            renderCards(bjDealerHand, 'dealerCards', true);
            
            document.getElementById('playerScore').textContent = getHandValue(bjPlayerHand);
            document.getElementById('dealerScore').textContent = '?';
            
            document.getElementById('bjControls').style.display = 'none';
            document.getElementById('bjGameControls').style.display = 'grid';
            document.getElementById('bjResult').innerHTML = '';
            
            if (getHandValue(bjPlayerHand) === 21) {
                await endBlackjack('blackjack');
            }
        }

        async function bjHit() {
            if (!bjGameActive) return;
            bjPlayerHand.push(bjDeck.pop());
            renderCards(bjPlayerHand, 'playerCards');
            document.getElementById('playerScore').textContent = getHandValue(bjPlayerHand);
            
            if (getHandValue(bjPlayerHand) > 21) {
                await endBlackjack('bust');
            }
        }

        async function bjStand() {
            if (!bjGameActive) return;
            await dealerPlay();
        }

        async function bjDouble() {
            if (!bjGameActive || bjPlayerHand.length > 2) return;
            if (bjBetAmount > currentUser.balance) {
                showToast('Cannot double - insufficient funds', 'error');
                return;
            }
            bjBetAmount *= 2;
            bjPlayerHand.push(bjDeck.pop());
            renderCards(bjPlayerHand, 'playerCards');
            document.getElementById('playerScore').textContent = getHandValue(bjPlayerHand);
            
            if (getHandValue(bjPlayerHand) > 21) {
                await endBlackjack('bust');
            } else {
                await dealerPlay();
            }
        }

        async function dealerPlay() {
            bjGameActive = false;
            renderCards(bjDealerHand, 'dealerCards');
            document.getElementById('dealerScore').textContent = getHandValue(bjDealerHand);
            
            while (getHandValue(bjDealerHand) < 17) {
                await new Promise(r => setTimeout(r, 500));
                bjDealerHand.push(bjDeck.pop());
                renderCards(bjDealerHand, 'dealerCards');
                document.getElementById('dealerScore').textContent = getHandValue(bjDealerHand);
            }
            
            const playerValue = getHandValue(bjPlayerHand);
            const dealerValue = getHandValue(bjDealerHand);
            
            if (dealerValue > 21) {
                await endBlackjack('dealer_bust');
            } else if (playerValue > dealerValue) {
                await endBlackjack('win');
            } else if (playerValue < dealerValue) {
                await endBlackjack('lose');
            } else {
                await endBlackjack('push');
            }
        }

        async function endBlackjack(outcome) {
            bjGameActive = false;
            renderCards(bjDealerHand, 'dealerCards');
            document.getElementById('dealerScore').textContent = getHandValue(bjDealerHand);
            
            let netAmount = 0;
            let message = '';
            
            switch (outcome) {
                case 'blackjack':
                    netAmount = bjBetAmount * 1.5;
                    message = `<span style="color: var(--success);">üé∞ BLACKJACK! +${formatMoney(bjBetAmount + netAmount)}</span>`;
                    createConfetti();
                    break;
                case 'win':
                case 'dealer_bust':
                    netAmount = bjBetAmount;
                    message = `<span style="color: var(--success);">üéâ You win! +${formatMoney(bjBetAmount * 2)}</span>`;
                    break;
                case 'lose':
                case 'bust':
                    netAmount = -bjBetAmount;
                    message = `<span style="color: var(--danger);">üíî ${outcome === 'bust' ? 'Bust!' : 'Dealer wins'} -${formatMoney(bjBetAmount)}</span>`;
                    break;
                case 'push':
                    netAmount = 0;
                    message = `<span style="color: var(--warning);">ü§ù Push - Bet returned</span>`;
                    break;
            }
            
            const result = await apiCall('gamble', {
                email: currentUser.email,
                game: 'blackjack',
                bet: bjBetAmount,
                outcome: netAmount >= 0 ? 'win' : 'lose',
                amount: netAmount
            });
            
            if (result.success) {
                currentUser.balance = result.balance;
                document.getElementById('balanceAmount').textContent = formatNumber(result.balance);
            }
            
            document.getElementById('bjResult').innerHTML = message;
            document.getElementById('bjControls').style.display = 'block';
            document.getElementById('bjGameControls').style.display = 'none';
        }

        // ==================== CHEAT - MULTIPLAYER LOBBY SYSTEM ====================
        function initCheatLobby() {
            loadActiveLobbies();
        }

        async function loadActiveLobbies() {
            stopCheatPolling();
            cheatLobbyId = null;
            cheatGameState = null;
            cheatSelectedCards = [];
            
            const result = await apiCall('getActiveLobbies', { email: currentUser.email });
            
            const statusDiv = document.getElementById('cheatStatus');
            const lobbyControls = document.getElementById('cheatLobbyControls');
            const gameControls = document.getElementById('cheatGameControls');
            const cardsContainer = document.getElementById('cheatCardsContainer');
            const pileArea = document.getElementById('cheatPileArea');
            const lastPlayInfo = document.getElementById('cheatLastPlayInfo');
            
            gameControls.style.display = 'none';
            cardsContainer.style.display = 'none';
            pileArea.style.display = 'none';
            lastPlayInfo.style.display = 'none';
            
            statusDiv.innerHTML = `
                <div style="font-size: 1.2rem; margin-bottom: 0.75rem;">üé¥ Cheat Lobbies</div>
                <div style="font-size: 0.8rem; color: var(--text-muted);">Join a lobby or create your own!</div>
            `;
            
            let lobbiesHtml = '';
            
            if (result.success && result.lobbies && result.lobbies.length > 0) {
                lobbiesHtml = '<div style="margin-bottom: 1rem;">';
                for (const lobby of result.lobbies) {
                    lobbiesHtml += `
                        <div style="background: rgba(0,0,0,0.2); border-radius: 8px; padding: 0.75rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: var(--gold);">${lobby.hostName}'s Lobby</div>
                                <div style="font-size: 0.75rem; color: var(--text-muted);">
                                    ${lobby.playerCount} player(s) ‚Ä¢ Pot: ${formatMoney(lobby.totalPot)}
                                </div>
                            </div>
                            <button class="btn btn-sm btn-success" onclick="joinCheatLobby('${lobby.lobbyId}')">Join</button>
                        </div>
                    `;
                }
                lobbiesHtml += '</div>';
            } else {
                lobbiesHtml = '<div style="text-align: center; color: var(--text-muted); padding: 1rem;">No active lobbies</div>';
            }
            
            lobbyControls.innerHTML = `
                ${lobbiesHtml}
                <button class="btn btn-success" onclick="createCheatLobby()" style="width: 100%;">üé¥ Create New Lobby</button>
                <button class="btn btn-sm" onclick="loadActiveLobbies()" style="width: 100%; margin-top: 0.5rem;">üîÑ Refresh</button>
            `;
        }

        async function createCheatLobby() {
            const buyIn = parseFloat(document.getElementById('cheatBet').value) || 100;
            
            if (buyIn < 100) {
                showToast('Minimum buy-in is $100', 'error');
                return;
            }
            
            if (buyIn > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }
            
            const result = await apiCall('createCheatLobby', {
                email: currentUser.email,
                buyIn: buyIn
            });
            
            if (result.success) {
                cheatLobbyId = result.lobbyId;
                showToast('Lobby created! Waiting for players...', 'success');
                updateBalance();
                startCheatPolling();
            } else {
                showToast(result.error || 'Failed to create lobby', 'error');
            }
        }

        async function joinCheatLobby(lobbyId) {
            const buyIn = parseFloat(document.getElementById('cheatBet').value) || 100;
            
            const result = await apiCall('joinCheatLobby', {
                email: currentUser.email,
                lobbyId: lobbyId,
                buyIn: buyIn
            });
            
            if (result.success) {
                cheatLobbyId = lobbyId;
                showToast('Joined lobby!', 'success');
                updateBalance();
                startCheatPolling();
            } else {
                showToast(result.error || 'Failed to join lobby', 'error');
            }
        }

        async function leaveCheatLobby() {
            if (!cheatLobbyId) return;
            
            const result = await apiCall('leaveCheatLobby', {
                email: currentUser.email,
                lobbyId: cheatLobbyId
            });
            
            if (result.success) {
                showToast('Left lobby. Buy-in refunded.', 'info');
                updateBalance();
                loadActiveLobbies();
            } else {
                showToast(result.error || 'Failed to leave', 'error');
            }
        }

        function startCheatPolling() {
            pollCheatLobby();
            cheatPollingInterval = setInterval(pollCheatLobby, 3000);
        }

        function stopCheatPolling() {
            if (cheatPollingInterval) {
                clearInterval(cheatPollingInterval);
                cheatPollingInterval = null;
            }
        }

        async function pollCheatLobby() {
            if (!cheatLobbyId) return;
            
            const result = await apiCall('getCheatLobby', {
                email: currentUser.email,
                lobbyId: cheatLobbyId
            });
            
            if (!result.success) {
                showToast('Lobby ended', 'info');
                loadActiveLobbies();
                return;
            }
            
            const lobby = result.lobby;
            const players = result.players || [];
            const isHost = lobby.host === currentUser.email;
            const playerCount = players.length;
            
            const statusDiv = document.getElementById('cheatStatus');
            const lobbyControls = document.getElementById('cheatLobbyControls');
            const gameControls = document.getElementById('cheatGameControls');
            
            if (lobby.status === 'waiting') {
                // In lobby waiting for more players
                statusDiv.innerHTML = `
                    <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">üé¥ Lobby - Waiting</div>
                    <div style="font-size: 1.5rem; color: var(--gold); font-weight: 700;">Pot: ${formatMoney(lobby.totalPot)}</div>
                    <div style="margin-top: 0.75rem; font-size: 0.85rem;">
                        ${players.map(p => `<div style="padding: 0.25rem;">${p.isHost ? 'üëë' : 'üë§'} ${p.name} (${formatMoney(p.buyIn)})</div>`).join('')}
                    </div>
                `;
                
                let controlsHtml = '';
                
                if (isHost) {
                    if (playerCount >= 2) {
                        controlsHtml = `
                            <button class="btn btn-success" onclick="startCheatGame()" style="width: 100%;">üéÆ Start Game (${playerCount} players)</button>
                        `;
                    } else {
                        controlsHtml = `
                            <div style="text-align: center; color: var(--warning); padding: 0.5rem;">‚è≥ Waiting for at least 2 players...</div>
                        `;
                    }
                } else {
                    controlsHtml = `<div style="text-align: center; color: var(--text-muted); padding: 0.5rem;">Waiting for host to start...</div>`;
                }
                
                controlsHtml += `<button class="btn btn-danger btn-sm" onclick="leaveCheatLobby()" style="width: 100%; margin-top: 0.5rem;">Leave Lobby</button>`;
                
                lobbyControls.innerHTML = controlsHtml;
                gameControls.style.display = 'none';
                
            } else if (lobby.status === 'playing') {
                // Game is active
                renderCheatGameState(result);
            } else if (lobby.status === 'finished') {
                showToast('Game ended!', 'info');
                loadActiveLobbies();
            }
        }

        async function startCheatGame() {
            if (!cheatLobbyId) return;
            
            const result = await apiCall('startCheatGame', {
                email: currentUser.email,
                lobbyId: cheatLobbyId
            });
            
            if (result.success) {
                showToast('Game started!', 'success');
                pollCheatLobby();
            } else {
                showToast(result.error || 'Failed to start game', 'error');
            }
        }

        function renderCheatGameState(result) {
            const lobby = result.lobby;
            const gameState = result.gameState;
            cheatGameState = gameState;
            cheatMyHand = result.myHand || [];
            
            const statusDiv = document.getElementById('cheatStatus');
            const lobbyControls = document.getElementById('cheatLobbyControls');
            const gameControls = document.getElementById('cheatGameControls');
            const cardsContainer = document.getElementById('cheatCardsContainer');
            const pileArea = document.getElementById('cheatPileArea');
            const lastPlayInfo = document.getElementById('cheatLastPlayInfo');
            
            lobbyControls.innerHTML = '';
            
            const isMyTurn = gameState.currentPlayer === currentUser.email;
            const currentPlayerName = gameState.currentPlayerName || 'Unknown';
            
            statusDiv.innerHTML = `
                <div style="font-size: 1rem; margin-bottom: 0.5rem;">üé¥ Cheat - Playing</div>
                <div style="color: ${isMyTurn ? 'var(--success)' : 'var(--warning)'}; font-weight: 700;">
                    ${isMyTurn ? "üéØ YOUR TURN!" : `‚è≥ ${currentPlayerName}'s turn`}
                </div>
                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">
                    Pot: ${formatMoney(lobby.totalPot)} ‚Ä¢ Cards in hand: ${cheatMyHand.length}
                </div>
            `;
            
            // Show pile info
            pileArea.style.display = 'block';
            document.getElementById('cheatPileCount').textContent = gameState.pileCount || 0;
            document.getElementById('cheatCurrentClaim').textContent = gameState.currentClaim || 'None';
            
            // Show last play info
            if (gameState.lastPlay) {
                lastPlayInfo.style.display = 'block';
                document.getElementById('cheatLastPlayDetails').textContent = gameState.lastPlay;
            } else {
                lastPlayInfo.style.display = 'none';
            }
            
            // Render hand
            cardsContainer.style.display = 'block';
            const cardsDiv = document.getElementById('cheatCards');
            cardsDiv.innerHTML = cheatMyHand.map((card, idx) => {
                const isRed = card.suit === '‚ô•' || card.suit === '‚ô¶';
                const selected = cheatSelectedCards.includes(idx);
                return `
                    <div class="cheat-card ${isRed ? 'red' : 'black'} ${selected ? 'selected' : ''}" onclick="toggleCheatCard(${idx})">
                        <div>${card.value}</div>
                        <div>${card.suit}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('cheatSelectedCount').textContent = cheatSelectedCards.length;
            
            // Game controls
            if (isMyTurn) {
                const canCallCheat = gameState.pileCount > 0 && gameState.lastPlayer;
                
                gameControls.style.display = 'block';
                gameControls.innerHTML = `
                    <div style="margin-bottom: 0.5rem;">
                        <label class="form-label">Claim (e.g., "2 Kings")</label>
                        <input type="text" id="cheatClaimInput" class="form-input" placeholder="e.g., 2 Kings">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <button class="btn btn-success" onclick="playCheatCards()">üÉè Play Cards</button>
                        <button class="btn btn-danger" onclick="callCheat()" ${canCallCheat ? '' : 'disabled'}>üö® Call Cheat!</button>
                    </div>
                `;
            } else {
                const canCallCheat = gameState.pileCount > 0 && gameState.lastPlayer && gameState.lastPlayer !== currentUser.email;
                
                gameControls.style.display = 'block';
                gameControls.innerHTML = `
                    <button class="btn btn-danger" onclick="callCheat()" ${canCallCheat ? '' : 'disabled'} style="width: 100%;">
                        üö® Call Cheat on ${gameState.lastPlayerName || 'player'}!
                    </button>
                `;
            }
        }

        function toggleCheatCard(idx) {
            const pos = cheatSelectedCards.indexOf(idx);
            if (pos === -1) {
                cheatSelectedCards.push(idx);
            } else {
                cheatSelectedCards.splice(pos, 1);
            }
            
            // Re-render cards with selection
            const cardsDiv = document.getElementById('cheatCards');
            cardsDiv.innerHTML = cheatMyHand.map((card, i) => {
                const isRed = card.suit === '‚ô•' || card.suit === '‚ô¶';
                const selected = cheatSelectedCards.includes(i);
                return `
                    <div class="cheat-card ${isRed ? 'red' : 'black'} ${selected ? 'selected' : ''}" onclick="toggleCheatCard(${i})">
                        <div>${card.value}</div>
                        <div>${card.suit}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('cheatSelectedCount').textContent = cheatSelectedCards.length;
        }

        async function playCheatCards() {
            if (cheatSelectedCards.length === 0) {
                showToast('Select at least one card', 'error');
                return;
            }
            
            const claim = document.getElementById('cheatClaimInput').value.trim();
            if (!claim) {
                showToast('Enter a claim (e.g., "2 Kings")', 'error');
                return;
            }
            
            const result = await apiCall('cheatPlayCards', {
                email: currentUser.email,
                lobbyId: cheatLobbyId,
                cardIndices: JSON.stringify(cheatSelectedCards),
                claim: claim
            });
            
            if (result.success) {
                cheatSelectedCards = [];
                pollCheatLobby();
            } else {
                showToast(result.error || 'Failed to play cards', 'error');
            }
        }

        async function callCheat() {
            const result = await apiCall('cheatCallCheat', {
                email: currentUser.email,
                lobbyId: cheatLobbyId
            });
            
            if (result.success) {
                const msg = result.caught 
                    ? `üéâ ${result.cheaterName} was caught cheating! They pick up the pile.`
                    : `üòÖ ${result.callerName} was wrong! They pick up the pile.`;
                showToast(msg, result.caught ? 'success' : 'warning');
                
                if (result.winner) {
                    showToast(`üèÜ ${result.winnerName} wins ${formatMoney(result.pot)}!`, 'success');
                    createConfetti();
                    updateBalance();
                    setTimeout(loadActiveLobbies, 3000);
                } else {
                    pollCheatLobby();
                }
            } else {
                showToast(result.error || 'Failed to call cheat', 'error');
            }
        }

        // ==================== CHAT ====================
        async function loadChat() {
            const result = await apiCall('getChat');
            const container = document.getElementById('chatMessages');
            
            if (result.success && result.messages && result.messages.length > 0) {
                container.innerHTML = result.messages.map(m => `
                    <div class="chat-message">
                        <span class="chat-username">${m.name}</span>
                        <span class="chat-time">${new Date(m.timestamp).toLocaleTimeString()}</span>
                        <div class="chat-text">${m.message}</div>
                    </div>
                `).join('');
                container.scrollTop = container.scrollHeight;
            } else {
                container.innerHTML = '<div class="empty-state"><p>No messages yet</p></div>';
            }
        }

        async function sendChat() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const result = await apiCall('sendChat', {
                email: currentUser.email,
                name: currentUser.name,
                message: message
            });
            
            if (result.success) {
                input.value = '';
                loadChat();
            } else {
                showToast(result.error || 'Failed to send', 'error');
            }
        }

        // ==================== LEADERBOARDS ====================
        async function loadLeaderboards() {
            const result = await apiCall('getLeaderboards');
            
            if (result.success) {
                renderLeaderboard('wealthLeaderboard', result.wealth, 'balance');
                renderLeaderboard('emojiLeaderboard', result.emoji, 'emojiScore');
            }
        }

        function renderLeaderboard(containerId, data, valueKey) {
            const container = document.getElementById(containerId);
            
            if (data && data.length > 0) {
                container.innerHTML = data.slice(0, 10).map((user, i) => {
                    const rank = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : (i + 1);
                    const isCurrentUser = user.email === currentUser.email;
                    return `
                        <div class="leaderboard-item ${isCurrentUser ? 'current-user' : ''}">
                            <span class="leaderboard-rank">${rank}</span>
                            <span class="leaderboard-name">${user.name}</span>
                            <span class="leaderboard-value">${valueKey === 'balance' ? formatMoney(user[valueKey]) : formatNumber(user[valueKey])}</span>
                        </div>
                    `;
                }).join('');
            } else {
                container.innerHTML = '<div class="empty-state"><p>No data yet</p></div>';
            }
        }

        // ==================== ADMIN ====================
        async function loadAdminUsers() {
            if (!currentUser.isAdmin) return;
            
            const result = await apiCall('getAllUsers', { email: currentUser.email });
            const container = document.getElementById('adminUsersList');
            
            if (result.success && result.users) {
                container.innerHTML = result.users.map(user => `
                    <div class="user-list-item">
                        <div>
                            <div style="font-weight: 600;">${user.name}</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">${user.email}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: var(--gold); font-weight: 700;">${formatMoney(user.balance)}</div>
                            <div style="font-size: 0.75rem;">Score: ${formatNumber(user.emojiScore || 0)}</div>
                        </div>
                    </div>
                `).join('');
            }
        }

        async function adminAddMoney() {
            if (!currentUser.isAdmin) return;
            
            const targetEmail = document.getElementById('adminTargetEmail').value.trim();
            const amount = parseFloat(document.getElementById('adminAddAmount').value);
            
            if (!targetEmail || !amount) {
                showToast('Fill in all fields', 'error');
                return;
            }
            
            const result = await apiCall('adminAddMoney', {
                adminEmail: currentUser.email,
                targetEmail: targetEmail,
                amount: amount
            });
            
            if (result.success) {
                showToast('Added ' + formatMoney(amount) + ' to ' + targetEmail, 'success');
                document.getElementById('adminTargetEmail').value = '';
                document.getElementById('adminAddAmount').value = '';
                loadAdminUsers();
            } else {
                showToast(result.error || 'Failed', 'error');
            }
        }

        // ==================== UTILITIES ====================
        function showChancesModal() {
            document.getElementById('chancesModal').classList.add('active');
        }

        function closeChancesModal() {
            document.getElementById('chancesModal').classList.remove('active');
        }

        function showSettingsModal() {
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function createConfetti() {
            const container = document.getElementById('confetti');
            container.innerHTML = '';
            
            const colors = ['#fbbf24', '#3b82f6', '#ef4444', '#22c55e', '#a855f7', '#ec4899'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: absolute;
                    width: ${Math.random() * 10 + 5}px;
                    height: ${Math.random() * 10 + 5}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    left: ${Math.random() * 100}%;
                    top: -20px;
                    opacity: ${Math.random() * 0.5 + 0.5};
                    transform: rotate(${Math.random() * 360}deg);
                    animation: confettiFall ${Math.random() * 2 + 2}s ease-out forwards;
                `;
                container.appendChild(confetti);
            }
            
            if (!document.getElementById('confettiStyle')) {
                const style = document.createElement('style');
                style.id = 'confettiStyle';
                style.textContent = `
                    @keyframes confettiFall {
                        0% { transform: translateY(0) rotate(0deg); opacity: 1; }
                        100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            setTimeout(() => container.innerHTML = '', 4000);
        }

        // Create background particles
        function createParticles() {
            const bg = document.querySelector('.bg-animation');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                bg.appendChild(particle);
            }
        }

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', () => {
            createParticles();
            
            const saved = localStorage.getItem('lintoriaUser');
            if (saved) {
                try {
                    currentUser = JSON.parse(saved);
                    showMainApp();
                } catch (e) {
                    localStorage.removeItem('lintoriaUser');
                }
            }
        });
    </script>
</body>
</html>
