<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lintoria Hub V4.03</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--primary:#2563eb;--gold:#fbbf24;--success:#10b981;--danger:#ef4444;--bg-primary:#050817;--bg-secondary:#0f172a;--text-primary:#f8fafc;--text-secondary:#cbd5e1;--text-muted:#64748b;--border:rgba(148,163,184,0.1);--rarity-common:#9ca3af;--rarity-uncommon:#22c55e;--rarity-rare:#3b82f6;--rarity-epic:#a855f7;--rarity-legendary:#fbbf24;--rarity-mythic:#ec4899;--rarity-divine:#06b6d4}
        body{font-family:'Inter',sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh}
        .hidden{display:none!important}
        .app-container{position:relative;z-index:10;min-height:100vh;padding:2rem;max-width:1400px;margin:0 auto}
        .glass-card{background:linear-gradient(135deg,rgba(37,99,235,0.05),rgba(251,191,36,0.05));backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:24px;padding:2rem;margin-bottom:1.5rem}
        .logo-container{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem}
        .logo-icon{width:60px;height:60px;background:linear-gradient(135deg,#2563eb,#fbbf24);border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:28px}
        .logo-text{font-size:2.5rem;font-weight:800;background:linear-gradient(135deg,#2563eb,#fbbf24);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .disclaimer{background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.3);border-radius:12px;padding:1rem;margin-bottom:1.5rem;font-size:0.875rem}
        .tab-container{display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:1.5rem;padding:1rem;background:rgba(15,23,42,0.5);border-radius:16px}
        .tab-btn{padding:0.75rem 1.25rem;background:rgba(37,99,235,0.1);color:var(--text-secondary);border:none;border-radius:12px;cursor:pointer;font-weight:600;transition:all 0.3s}
        .tab-btn:hover{color:var(--text-primary);background:rgba(251,191,36,0.2)}
        .tab-btn.active{background:linear-gradient(135deg,#2563eb,#fbbf24);color:white}
        .form-group{margin-bottom:1.25rem}
        .form-label{display:block;margin-bottom:0.5rem;font-weight:600;color:var(--gold);font-size:0.875rem;text-transform:uppercase}
        .form-input,select{width:100%;padding:1rem;background:rgba(15,23,42,0.6);border:2px solid var(--border);border-radius:12px;color:var(--text-primary);font-size:1rem}
        .form-input:focus,select:focus{outline:none;border-color:var(--gold)}
        .btn{padding:1rem 2rem;border:none;border-radius:12px;font-weight:700;cursor:pointer;transition:all 0.3s;background:linear-gradient(135deg,#2563eb,#3b82f6);color:white}
        .btn:hover{transform:translateY(-2px)}
        .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
        .btn-success{background:linear-gradient(135deg,#f59e0b,#fbbf24);color:#000}
        .btn-danger{background:linear-gradient(135deg,#ef4444,#dc2626)}
        .btn-sm{padding:0.5rem 1rem;font-size:0.8rem}
        .balance-card{background:linear-gradient(135deg,#1e40af,#fbbf24);padding:2.5rem;border-radius:24px;text-align:center;margin-bottom:1.5rem}
        .balance-label{font-size:0.875rem;text-transform:uppercase;letter-spacing:2px;opacity:0.9}
        .balance-amount{font-size:3.5rem;font-weight:900;font-family:'Space Grotesk',sans-serif}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:1rem;margin-bottom:1.5rem}
        .stat-card{background:rgba(15,23,42,0.6);border:1px solid var(--border);border-radius:16px;padding:1.25rem;text-align:center}
        .stat-value{font-size:1.5rem;font-weight:800;color:var(--gold)}
        .stat-label{font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;margin-top:0.25rem}
        .section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;padding-bottom:0.75rem;border-bottom:1px solid var(--border)}
        .section-header h2{font-size:1.25rem;color:var(--gold)}
        .service-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem}
        .pack-card{background:rgba(37,99,235,0.1);border:2px solid var(--border);border-radius:16px;padding:1.25rem;text-align:center;cursor:pointer;transition:all 0.3s}
        .pack-card:hover{border-color:var(--gold);transform:translateY(-3px)}
        .pack-card.selected{border-color:var(--gold);background:rgba(251,191,36,0.15)}
        .pack-name{font-weight:700;color:var(--gold);margin-bottom:0.5rem}
        .pack-emojis{font-size:1.2rem;margin:0.5rem 0}
        .emoji-card{display:inline-flex;flex-direction:column;align-items:center;padding:0.75rem;border-radius:10px;margin:0.25rem;cursor:pointer;transition:transform 0.2s}
        .emoji-card:hover{transform:scale(1.1)}
        .emoji-card .emoji{font-size:2rem}
        .emoji-card.common{background:rgba(156,163,175,0.15);border:1px solid var(--rarity-common)}
        .emoji-card.uncommon{background:rgba(34,197,94,0.15);border:1px solid var(--rarity-uncommon)}
        .emoji-card.rare{background:rgba(59,130,246,0.15);border:1px solid var(--rarity-rare)}
        .emoji-card.epic{background:rgba(168,85,247,0.15);border:1px solid var(--rarity-epic)}
        .emoji-card.legendary{background:rgba(251,191,36,0.15);border:1px solid var(--rarity-legendary);animation:glow 2s infinite}
        .emoji-card.mythic{background:rgba(236,72,153,0.15);border:1px solid var(--rarity-mythic);animation:glow 1.5s infinite}
        .emoji-card.divine{background:rgba(6,182,212,0.2);border:2px solid var(--rarity-divine);animation:glow 1s infinite}
        @keyframes glow{0%,100%{box-shadow:0 0 5px currentColor}50%{box-shadow:0 0 20px currentColor}}
        .rarity-badge{display:inline-block;padding:0.15rem 0.4rem;border-radius:6px;font-size:0.6rem;font-weight:700;text-transform:uppercase}
        .rarity-badge.common{background:var(--rarity-common);color:#000}
        .rarity-badge.uncommon{background:var(--rarity-uncommon);color:#000}
        .rarity-badge.rare{background:var(--rarity-rare);color:#fff}
        .rarity-badge.epic{background:var(--rarity-epic);color:#fff}
        .rarity-badge.legendary{background:var(--rarity-legendary);color:#000}
        .rarity-badge.mythic{background:var(--rarity-mythic);color:#fff}
        .rarity-badge.divine{background:var(--rarity-divine);color:#000}
        .casino-game{background:rgba(37,99,235,0.08);border:1px solid var(--border);border-radius:16px;padding:1.5rem;margin-bottom:1rem}
        .casino-game h3{color:var(--gold);margin-bottom:0.5rem}
        /* PLINKO */
        .plinko-container{position:relative;width:100%;max-width:380px;margin:1rem auto;background:linear-gradient(180deg,#0a0a1a,#151530);border-radius:12px;padding:8px;border:2px solid var(--gold)}
        .plinko-board{position:relative;width:360px;height:400px;margin:0 auto;overflow:hidden}
        .plinko-peg{position:absolute;width:8px;height:8px;background:radial-gradient(circle at 30% 30%,#ffd700,#b8860b);border-radius:50%;box-shadow:0 0 6px rgba(255,215,0,0.6);transform:translate(-50%,-50%)}
        .plinko-ball{position:absolute;width:16px;height:16px;background:radial-gradient(circle at 30% 30%,#ff6b6b,#cc0000);border-radius:50%;box-shadow:0 0 12px rgba(255,107,107,0.8);z-index:100;transform:translate(-50%,-50%)}
        .plinko-slots{display:flex;justify-content:center;position:absolute;bottom:0;left:50%;transform:translateX(-50%);gap:2px}
        .plinko-slot{width:32px;height:40px;display:flex;align-items:center;justify-content:center;font-size:0.5rem;font-weight:800;border-radius:4px 4px 0 0;color:white}
        .plinko-slot[data-mult="0.2"]{background:#6b7280}
        .plinko-slot[data-mult="0.5"]{background:#8b5cf6}
        .plinko-slot[data-mult="1"]{background:#3b82f6}
        .plinko-slot[data-mult="2"]{background:#06b6d4}
        .plinko-slot[data-mult="5"]{background:#22c55e}
        .plinko-slot[data-mult="10"]{background:#84cc16}
        .plinko-slot[data-mult="25"]{background:#eab308}
        .plinko-slot[data-mult="50"]{background:#f97316}
        .plinko-slot[data-mult="100"]{background:#ef4444}
        .plinko-slot.active{transform:scaleY(1.15);box-shadow:0 0 15px currentColor}
        /* ROULETTE */
        .roulette-container{position:relative;width:260px;height:260px;margin:1rem auto}
        .roulette-wheel{width:100%;height:100%;border-radius:50%;border:6px solid var(--gold);box-shadow:0 0 30px rgba(251,191,36,0.4);overflow:hidden;position:relative;background:#1a1a2e}
        .roulette-segment{position:absolute;width:50%;height:50%;left:50%;top:50%;transform-origin:0 0;clip-path:polygon(0 0,100% 0,100% 100%)}
        .roulette-segment span{position:absolute;font-size:0.65rem;font-weight:700;color:white;left:35%;top:20%;transform:rotate(5deg)}
        .roulette-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:50px;height:50px;background:linear-gradient(135deg,#f59e0b,#fbbf24);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.25rem;z-index:10}
        .roulette-pointer{position:absolute;top:-15px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;border-top:24px solid var(--gold);z-index:20}
        .roulette-bet-options{display:grid;grid-template-columns:repeat(3,1fr);gap:0.5rem;margin:1rem 0}
        .roulette-bet-btn{padding:0.6rem;border:2px solid var(--border);border-radius:8px;background:rgba(15,23,42,0.6);color:var(--text-primary);font-weight:600;cursor:pointer;font-size:0.8rem}
        .roulette-bet-btn:hover{border-color:var(--gold)}
        .roulette-bet-btn.selected{border-color:var(--gold);background:rgba(251,191,36,0.2)}
        .roulette-bet-btn.red{border-color:#dc2626}
        .roulette-bet-btn.black{border-color:#374151}
        .roulette-bet-btn.green{border-color:#16a34a}
        /* DICE */
        .dice-container{perspective:600px;width:80px;height:80px;margin:1rem auto}
        .dice{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform 1s}
        .dice.rolling{animation:rollDice 1s}
        @keyframes rollDice{0%{transform:rotateX(0) rotateY(0)}50%{transform:rotateX(360deg) rotateY(180deg)}100%{transform:rotateX(720deg) rotateY(360deg)}}
        .dice-face{position:absolute;width:80px;height:80px;background:linear-gradient(135deg,#fff,#e0e0e0);border:3px solid #333;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:2rem;color:#000}
        .dice-face.front{transform:translateZ(40px)}
        .dice-face.back{transform:rotateY(180deg) translateZ(40px)}
        .dice-face.right{transform:rotateY(90deg) translateZ(40px)}
        .dice-face.left{transform:rotateY(-90deg) translateZ(40px)}
        .dice-face.top{transform:rotateX(90deg) translateZ(40px)}
        .dice-face.bottom{transform:rotateX(-90deg) translateZ(40px)}
        /* SLOTS */
        .slots-machine{background:#1a1a2e;border-radius:16px;padding:1.5rem;max-width:300px;margin:1rem auto;border:3px solid var(--gold)}
        .slots-display{display:flex;justify-content:center;gap:0.4rem;background:#0a0a0a;padding:0.75rem;border-radius:10px}
        .slot-reel{width:60px;height:70px;background:#1a1a1a;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:2.5rem;border:2px solid #444}
        .slot-reel.spinning .slot-symbol{animation:slotSpin 0.1s linear infinite}
        @keyframes slotSpin{0%{transform:translateY(-100%)}100%{transform:translateY(100%)}}
        /* COIN */
        .coin{width:80px;height:80px;margin:1rem auto;position:relative;transform-style:preserve-3d}
        .coin.flipping{animation:coinFlip 1.5s}
        @keyframes coinFlip{0%{transform:rotateY(0) translateY(0)}50%{transform:rotateY(1800deg) translateY(-80px)}100%{transform:rotateY(3600deg) translateY(0)}}
        .coin-face{position:absolute;width:100%;height:100%;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2.5rem;backface-visibility:hidden}
        .coin-heads{background:linear-gradient(135deg,#ffd700,#ffed4a);border:3px solid #b8860b}
        .coin-tails{background:linear-gradient(135deg,#c0c0c0,#e8e8e8);border:3px solid #808080;transform:rotateY(180deg)}
        /* RESULTS */
        .result{margin-top:1rem;text-align:center;font-weight:700;min-height:40px}
        .win-animation{animation:winPulse 0.5s 3}
        .lose-animation{animation:losePulse 0.5s 2}
        @keyframes winPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
        @keyframes losePulse{0%,100%{opacity:1}50%{opacity:0.5}}
        /* MODAL */
        .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(5,8,23,0.9);z-index:1000;display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:all 0.3s}
        .modal-overlay.active{opacity:1;visibility:visible}
        .modal-content{background:var(--bg-secondary);border:1px solid var(--border);border-radius:20px;padding:1.5rem;width:90%;max-width:500px;max-height:85vh;overflow-y:auto}
        .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:0.75rem;border-bottom:1px solid var(--border)}
        .modal-close{background:none;border:none;color:var(--text-muted);font-size:1.5rem;cursor:pointer}
        .toast{position:fixed;top:1.5rem;right:-350px;padding:1rem 1.5rem;background:linear-gradient(135deg,#2563eb,#fbbf24);border-radius:12px;transition:right 0.4s;z-index:2000;color:white;font-weight:600;min-width:250px}
        .toast.show{right:1.5rem}
        .toast.success{background:linear-gradient(135deg,#10b981,#059669)}
        .toast.error{background:linear-gradient(135deg,#ef4444,#dc2626)}
        .pack-opening{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(5,8,23,0.95);z-index:3000;display:flex;flex-direction:column;align-items:center;justify-content:center}
        .pack-reveal{font-size:7rem;animation:packReveal 1s}
        @keyframes packReveal{0%{transform:scale(0) rotate(-180deg);opacity:0}50%{transform:scale(1.2) rotate(10deg)}100%{transform:scale(1) rotate(0);opacity:1}}
        .pack-rarity-text{font-size:1.75rem;font-weight:800;margin-top:1rem}
        .empty-state{text-align:center;padding:3rem;color:var(--text-muted)}
        .empty-icon{font-size:3rem;opacity:0.3;margin-bottom:0.5rem}
        .transaction-item{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:rgba(37,99,235,0.05);border:1px solid var(--border);border-radius:12px;margin-bottom:0.75rem}
        .chances-table{width:100%;border-collapse:collapse;margin-top:1rem}
        .chances-table th,.chances-table td{padding:0.6rem;text-align:left;border-bottom:1px solid var(--border)}
        .chances-table th{color:var(--gold)}
        .rarity-section{margin-bottom:1rem}
        .rarity-section-header{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;padding-bottom:0.25rem;border-bottom:1px solid var(--border)}
        .pack-contents-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(50px,1fr));gap:0.4rem;padding:0.5rem;background:rgba(15,23,42,0.5);border-radius:8px}
        .pack-emoji-item{text-align:center;padding:0.4rem;border-radius:6px;font-size:1.3rem}
        @media(max-width:768px){.logo-text{font-size:1.75rem}.balance-amount{font-size:2.5rem}.plinko-board{width:300px;height:340px}.roulette-container{width:220px;height:220px}}
    </style>
</head>
<body>
    <div class="app-container">
        <!-- AUTH -->
        <div id="authScreen">
            <div style="max-width:450px;margin:0 auto">
                <div class="logo-container"><div class="logo-icon">üèõÔ∏è</div><span class="logo-text">Lintoria Hub</span></div>
                <div class="disclaimer"><strong>‚ö†Ô∏è DISCLAIMER:</strong> Virtual economy simulation. No real money. For entertainment only!</div>
                <div class="glass-card">
                    <div class="tab-container" style="margin-bottom:1.5rem">
                        <button class="tab-btn active" onclick="switchAuthTab('login')">üîê Login</button>
                        <button class="tab-btn" onclick="switchAuthTab('register')">‚ú® Register</button>
                    </div>
                    <div id="loginTab">
                        <div class="form-group"><label class="form-label">Email</label><input type="email" id="loginEmail" class="form-input" placeholder="email@example.com"></div>
                        <div class="form-group"><label class="form-label">Password</label><input type="password" id="loginPassword" class="form-input" placeholder="Password"></div>
                        <button class="btn" onclick="login()" style="width:100%">Sign In</button>
                    </div>
                    <div id="registerTab" class="hidden">
                        <div class="form-group"><label class="form-label">Email</label><input type="email" id="registerEmail" class="form-input"></div>
                        <div class="form-group"><label class="form-label">Name</label><input type="text" id="registerName" class="form-input"></div>
                        <div class="form-group"><label class="form-label">Password</label><input type="password" id="registerPassword" class="form-input"></div>
                        <button class="btn btn-success" onclick="register()" style="width:100%">Create Account</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- MAIN APP -->
        <div id="appScreen" class="hidden">
            <div class="disclaimer"><strong>‚ö†Ô∏è</strong> Virtual simulation - No real money!</div>
            <div class="glass-card" style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem">
                <div class="logo-container" style="margin:0"><div class="logo-icon">üèõÔ∏è</div><div><div class="logo-text" style="font-size:1.75rem">Lintoria</div><div style="color:var(--text-muted);font-size:0.8rem">Welcome, <span id="userName" style="color:var(--gold);font-weight:700"></span></div></div></div>
                <div style="display:flex;gap:0.5rem"><button class="btn btn-sm" onclick="showSettingsModal()">‚öôÔ∏è</button><button class="btn btn-danger btn-sm" onclick="logout()">Logout</button></div>
            </div>
            <div class="tab-container">
                <button class="tab-btn active" onclick="switchTab('dashboard')">üè¶ Bank</button>
                <button class="tab-btn" onclick="switchTab('transfer')">üí∏ Transfer</button>
                <button class="tab-btn" onclick="switchTab('packs')">üéÅ Packs</button>
                <button class="tab-btn" onclick="switchTab('collection')">üéí Collection</button>
                <button class="tab-btn" onclick="switchTab('casino')">üé∞ Casino</button>
                <button class="tab-btn" onclick="switchTab('leaderboard')">üèÜ Leaders</button>
            </div>
            <!-- DASHBOARD -->
            <div id="dashboardContent" class="tab-content">
                <div class="balance-card"><div class="balance-label">Total Balance</div><div class="balance-amount">$<span id="balanceAmount">0</span></div></div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="creditScoreDisplay">650</div><div class="stat-label">Credit Score</div></div>
                    <div class="stat-card"><div class="stat-value" id="emojiScoreDisplay">0</div><div class="stat-label">Emoji Score</div></div>
                </div>
            </div>
            <!-- TRANSFER -->
            <div id="transferContent" class="tab-content hidden">
                <div class="glass-card">
                    <h2 style="color:var(--gold);margin-bottom:1rem">üí∏ Send Money</h2>
                    <div class="form-group"><label class="form-label">Recipient Email</label><input type="email" id="recipientEmail" class="form-input"></div>
                    <div class="form-group"><label class="form-label">Amount ($)</label><input type="number" id="transferAmount" class="form-input" min="0.01" step="0.01"></div>
                    <div class="form-group"><label class="form-label">Note</label><input type="text" id="transferNote" class="form-input"></div>
                    <button class="btn btn-success" onclick="transferMoney()" style="width:100%">Send</button>
                </div>
            </div>
            <!-- PACKS -->
            <div id="packsContent" class="tab-content hidden">
                <div class="glass-card">
                    <div class="section-header"><h2>üéÅ Emoji Packs (20 Unique!)</h2><button class="btn btn-sm" onclick="showChancesModal()">üìä Chances</button></div>
                    <div style="background:rgba(37,99,235,0.1);border-radius:10px;padding:1rem;margin-bottom:1rem;text-align:center">
                        <p style="font-size:1.25rem;color:var(--gold);font-weight:700">$7,500 per pack</p>
                    </div>
                    <div class="service-grid" id="packsList"></div>
                    <div style="margin-top:1.5rem;text-align:center">
                        <button class="btn btn-success" onclick="buyPack()" id="buyPackBtn" style="font-size:1.1rem;padding:1.25rem 2.5rem" disabled>üéÅ Open Pack</button>
                        <p id="selectedPackName" style="color:var(--text-muted);margin-top:0.75rem">Select a pack</p>
                        <button class="btn btn-sm" onclick="showPackContentsModal()" id="viewPackBtn" style="margin-top:0.5rem" disabled>üëÅÔ∏è View Contents</button>
                    </div>
                </div>
            </div>
            <!-- COLLECTION -->
            <div id="collectionContent" class="tab-content hidden">
                <div class="glass-card">
                    <div class="section-header"><h2>üéí Your Collection</h2><span style="color:var(--gold)" id="emojiScore">0 pts</span></div>
                    <div id="emojiCollection"><div class="empty-state"><div class="empty-icon">üéí</div><p>No emojis yet</p></div></div>
                </div>
            </div>
            <!-- CASINO -->
            <div id="casinoContent" class="tab-content hidden">
                <div class="glass-card">
                    <h2 style="color:var(--gold);margin-bottom:0.5rem">üé∞ Casino</h2>
                    <p style="color:var(--danger);margin-bottom:1rem;font-size:0.875rem">‚ö†Ô∏è House edge: 40-60%</p>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1.5rem">
                        <!-- PLINKO -->
                        <div class="casino-game">
                            <h3>üìç Plinko</h3>
                            <p style="color:var(--text-muted);font-size:0.75rem;margin-bottom:0.5rem">Drop the ball! Win up to 100x!</p>
                            <div class="plinko-container"><div class="plinko-board" id="plinkoBoard"></div></div>
                            <input type="number" id="plinkoBet" class="form-input" placeholder="Bet amount" min="1" style="margin:0.75rem 0">
                            <button class="btn btn-success" onclick="playPlinko()" id="plinkoBtn" style="width:100%">Drop Ball!</button>
                            <div class="result" id="plinkoResult"></div>
                        </div>
                        <!-- ROULETTE -->
                        <div class="casino-game">
                            <h3>üé° Roulette</h3>
                            <p style="color:var(--text-muted);font-size:0.75rem;margin-bottom:0.5rem">Red/Black 1.8x, Green 14x!</p>
                            <div class="roulette-container">
                                <div class="roulette-pointer"></div>
                                <div class="roulette-wheel" id="rouletteWheel"></div>
                                <div class="roulette-center">üé∞</div>
                            </div>
                            <div class="roulette-bet-options">
                                <button class="roulette-bet-btn red" onclick="selectRouletteBet('red')" id="betRed">üî¥ Red</button>
                                <button class="roulette-bet-btn black" onclick="selectRouletteBet('black')" id="betBlack">‚ö´ Black</button>
                                <button class="roulette-bet-btn green" onclick="selectRouletteBet('green')" id="betGreen">üü¢ Green</button>
                            </div>
                            <input type="number" id="rouletteBet" class="form-input" placeholder="Bet amount" min="1" style="margin:0.5rem 0">
                            <button class="btn" onclick="playRoulette()" id="rouletteBtn" style="width:100%" disabled>Spin!</button>
                            <div class="result" id="rouletteResult"></div>
                        </div>
                        <!-- DICE -->
                        <div class="casino-game">
                            <h3>üé≤ Dice</h3>
                            <p style="color:var(--text-muted);font-size:0.75rem;margin-bottom:0.5rem">Roll 4-6 to win 1.9x!</p>
                            <div class="dice-container"><div class="dice" id="dice"><div class="dice-face front">‚öÄ</div><div class="dice-face back">‚öÖ</div><div class="dice-face right">‚öÇ</div><div class="dice-face left">‚öÉ</div><div class="dice-face top">‚öÅ</div><div class="dice-face bottom">‚öÑ</div></div></div>
                            <input type="number" id="diceBet" class="form-input" placeholder="Bet amount" min="1" style="margin:0.75rem 0">
                            <button class="btn" onclick="playDice()" id="diceBtn" style="width:100%">Roll!</button>
                            <div class="result" id="diceResult"></div>
                        </div>
                        <!-- SLOTS -->
                        <div class="casino-game">
                            <h3>üé∞ Slots</h3>
                            <p style="color:var(--text-muted);font-size:0.75rem;margin-bottom:0.5rem">Match 3 for up to 25x!</p>
                            <div class="slots-machine"><div class="slots-display"><div class="slot-reel" id="reel1"><span class="slot-symbol">üé∞</span></div><div class="slot-reel" id="reel2"><span class="slot-symbol">üé∞</span></div><div class="slot-reel" id="reel3"><span class="slot-symbol">üé∞</span></div></div></div>
                            <input type="number" id="slotsBet" class="form-input" placeholder="Bet amount" min="1" style="margin:0.75rem 0">
                            <button class="btn btn-success" onclick="playSlots()" id="slotsBtn" style="width:100%">Spin!</button>
                            <div class="result" id="slotsResult"></div>
                        </div>
                        <!-- COIN -->
                        <div class="casino-game">
                            <h3>ü™ô Coin Flip</h3>
                            <p style="color:var(--text-muted);font-size:0.75rem;margin-bottom:0.5rem">45% to win 1.9x!</p>
                            <div style="perspective:300px"><div class="coin" id="coin"><div class="coin-face coin-heads">üëë</div><div class="coin-face coin-tails">ü¶Ö</div></div></div>
                            <input type="number" id="coinBet" class="form-input" placeholder="Bet amount" min="1" style="margin:0.75rem 0">
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.5rem">
                                <button class="btn" onclick="playCoinFlip('heads')" id="headsBtn">üëë Heads</button>
                                <button class="btn btn-success" onclick="playCoinFlip('tails')" id="tailsBtn">ü¶Ö Tails</button>
                            </div>
                            <div class="result" id="coinResult"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- LEADERBOARD -->
            <div id="leaderboardContent" class="tab-content hidden">
                <div class="glass-card"><div class="section-header"><h2>üí∞ Wealth</h2></div><div id="wealthLeaderboard"><div class="empty-state"><p>Loading...</p></div></div></div>
            </div>
        </div>
    </div>
    <!-- TOAST -->
    <div id="toast" class="toast"><div id="toastMessage"></div></div>
    <!-- MODALS -->
    <div class="modal-overlay" id="chancesModal">
        <div class="modal-content">
            <div class="modal-header"><h2 style="color:var(--gold)">üìä Drop Chances</h2><button class="modal-close" onclick="closeChancesModal()">√ó</button></div>
            <table class="chances-table"><thead><tr><th>Rarity</th><th>Chance</th><th>Points</th><th>Sell</th></tr></thead><tbody>
                <tr><td><span class="rarity-badge common">Common</span></td><td>50%</td><td>10</td><td>$500</td></tr>
                <tr><td><span class="rarity-badge uncommon">Uncommon</span></td><td>30%</td><td>25</td><td>$2K</td></tr>
                <tr><td><span class="rarity-badge rare">Rare</span></td><td>12%</td><td>100</td><td>$10K</td></tr>
                <tr><td><span class="rarity-badge epic">Epic</span></td><td>5%</td><td>500</td><td>$25K</td></tr>
                <tr><td><span class="rarity-badge legendary">Legendary</span></td><td>2%</td><td>2.5K</td><td>$75K</td></tr>
                <tr><td><span class="rarity-badge mythic">Mythic</span></td><td>0.8%</td><td>10K</td><td>$200K</td></tr>
                <tr><td><span class="rarity-badge divine">Divine</span></td><td>0.2%</td><td>50K</td><td>$500K</td></tr>
            </tbody></table>
        </div>
    </div>
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header"><h2 style="color:var(--gold)">‚öôÔ∏è Settings</h2><button class="modal-close" onclick="closeSettingsModal()">√ó</button></div>
            <div style="background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.3);border-radius:12px;padding:1rem">
                <h3 style="color:var(--danger);margin-bottom:0.5rem">üîÑ Reset Account</h3>
                <p style="font-size:0.8rem;margin-bottom:1rem">Start fresh with $100,000</p>
                <button class="btn btn-danger" onclick="confirmResetAccount()" style="width:100%">Reset</button>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="packContentsModal">
        <div class="modal-content">
            <div class="modal-header"><h2 style="color:var(--gold)" id="packContentsTitle">Pack Contents</h2><button class="modal-close" onclick="closePackContentsModal()">√ó</button></div>
            <div id="packContentsBody"></div>
        </div>
    </div>
    <div id="packOpeningModal" class="hidden"></div>
    <script>
        const SHEETS_URL = 'https://script.google.com/macros/s/AKfycbz3CPKFWGqeAZYTdhe0FcVZgDB7HDrouu7PynSB_99BRvpyMzXjzr3DtRENmBIf7ppoFA/exec';
        let currentUser = null;
        let selectedPack = null;
        let selectedRouletteBet = null;

        // 20 UNIQUE PACKS
        const THEMED_PACKS = {
            nature: { name: 'üåø Nature', emojis: { common: ['üå±','üåø','üçÄ','üåæ','üåµ','üå¥','üå≥','üå≤','üçÉ','üçÇ','üçÅ','ü™¥','üåª','üåº','üå∏','üå∫','üå∑','üåπ','üíê','ü™ª'], uncommon: ['üçÑ','ü™∏','ü™µ','ü™®','üåä','üíß','üî•','üå¨Ô∏è','‚òÄÔ∏è','üå§Ô∏è'], rare: ['üåà','üåÖ','üåÑ','üåá','üèûÔ∏è','üèîÔ∏è','üåã','üóª','üèùÔ∏è','üèñÔ∏è'], epic: ['ü¶ã','üêù','üêû','ü¶ó','ü™≤','üêõ','üêå','üêö','üï∑Ô∏è','ü¶Ç'], legendary: ['üêâ','ü¶ï','ü¶ñ','ü¶§','ü¶©','ü¶ö','ü¶ú','ü¶¢'], mythic: ['üåç','üåé','üåè','ü™ê','üåô','‚≠ê'], divine: ['üîÆ','üíé','üëë'] }},
            space: { name: 'üöÄ Space', emojis: { common: ['‚≠ê','‚ú®','üí´','üåü','‚ú¥Ô∏è','üî∏','üîπ','üî∂','üî∑','‚ö™','‚ö´','üü§','üî¥','üü†','üü°','üü¢','üîµ','üü£','üü•','üüß'], uncommon: ['üåë','üåí','üåì','üåî','üåï','üåñ','üåó','üåò','üåô','üåö'], rare: ['ü™ê','‚òÑÔ∏è','üí•','üåä','üåà','‚ö°','üî•','üíß','üåÄ','üå™Ô∏è'], epic: ['üõ∏','üöÄ','üõ∞Ô∏è','üî≠','üì°','üõ©Ô∏è','‚úàÔ∏è','üöÅ','üõ∂','‚õµ'], legendary: ['üëΩ','üëæ','ü§ñ','üõ∏','üåå','üå†','‚òÑÔ∏è','ü™ê'], mythic: ['üåç','üåé','üåè','üåê','üó∫Ô∏è','üß≠'], divine: ['üî±','‚öúÔ∏è','üí†'] }},
            ocean: { name: 'üåä Ocean', emojis: { common: ['üåä','üíß','üí¶','ü´ß','üßä','‚ùÑÔ∏è','üí†','üîπ','üî∑','üü¶','üêö','ü™∏','ü™º','ü¶™','üßÇ','üåÄ','„Ä∞Ô∏è','‚ôí','üåê','üíé'], uncommon: ['üêü','üê†','üê°','ü¶à','üê¨','üê≥','üêã','ü¶≠','ü¶¶','ü¶ê'], rare: ['üêô','ü¶ë','ü¶Ä','ü¶û','ü¶ê','üê¢','üêä','ü¶é','üêç','ü¶ï'], epic: ['‚öì','üö¢','‚õµ','üö§','üõ•Ô∏è','üõ≥Ô∏è','‚õ¥Ô∏è','üöÄ','üõ∂','ü™ù'], legendary: ['üßú‚Äç‚ôÄÔ∏è','üßú‚Äç‚ôÇÔ∏è','üî±','üåä','üíé','üêö','ü¶ë','üêô'], mythic: ['üèùÔ∏è','üèñÔ∏è','üåÖ','üå¥','üóø','üèõÔ∏è'], divine: ['üî±','üëë','üíé'] }},
            fire: { name: 'üî• Fire', emojis: { common: ['üî•','üî¥','üü†','üü°','‚ù§Ô∏è','üß°','üíõ','‚ô®Ô∏è','üå°Ô∏è','‚òÄÔ∏è','üî∏','üî∂','üí¢','‚≠ï','üéØ','üîª','üî∫','üìõ','üõë','‚õî'], uncommon: ['üåã','üí•','‚ú®','‚ö°','üåü','üí´','üéÜ','üéá','üß®','üí£'], rare: ['üêâ','ü¶ñ','ü¶ä','ü¶Å','üêØ','ü¶Ö','ü¶Ç','üêç','ü¶é','üê≤'], epic: ['üèçÔ∏è','üöí','üöÄ','üõ©Ô∏è','‚úàÔ∏è','üöÅ','‚õΩ','üõ¢Ô∏è','üîß','‚öôÔ∏è'], legendary: ['üî•','üíÄ','üëπ','üë∫','üòà','üëø','üêâ','ü¶¥'], mythic: ['üåã','üåÖ','üåÑ','‚òÄÔ∏è','üåû','‚ö°'], divine: ['üî•','üíé','üëë'] }},
            diamonds: { name: 'üíé Diamonds', emojis: { common: ['üí†','üî∑','üîπ','üîµ','üü¶','üî∂','üî∏','üü†','üüß','üî¥','üü•','üü°','üü®','üü¢','üü©','üü£','üü™','‚ö™','‚¨ú','üîò'], uncommon: ['üíç','üìø','üëë','üëí','üé©','üß¢','‚õëÔ∏è','ü™ñ','üíÑ','üíã'], rare: ['üíé','üíç','üëë','üèÜ','ü•á','ü•à','ü•â','üèÖ','üéñÔ∏è','üéóÔ∏è'], epic: ['ü™ô','üí∞','üíµ','üí¥','üí∂','üí∑','üí∏','üí≥','üßæ','üíπ'], legendary: ['üíé','üëë','üèÜ','ü•á','üíç','üìø','üîÆ','ü™¨'], mythic: ['üåü','‚≠ê','‚ú®','üí´','‚òÑÔ∏è','üî•'], divine: ['üëë','üíé','üî±'] }},
            animals: { name: 'üêæ Animals', emojis: { common: ['üê∂','üê±','üê≠','üêπ','üê∞','ü¶ä','üêª','üêº','üê®','üêØ','ü¶Å','üêÆ','üê∑','üê∏','üêµ','üôà','üôâ','üôä','üêí','üêî'], uncommon: ['üêß','üê¶','üê§','üê£','üê•','ü¶Ü','ü¶Ö','ü¶â','ü¶á','üê∫'], rare: ['üêó','üê¥','ü¶Ñ','üêù','üêõ','ü¶ã','üêå','üêû','üêú','ü¶ü'], epic: ['ü¶ó','ü™≤','ü¶Ç','üê¢','üêç','ü¶é','ü¶ñ','ü¶ï','üêô','ü¶ë'], legendary: ['ü¶í','ü¶ò','ü¶¨','üêÉ','üêÇ','üêÑ','üêé','ü¶å'], mythic: ['ü¶Æ','üêï‚Äçü¶∫','üêà','üêà‚Äç‚¨õ','üêì','ü¶É','ü¶ö','ü¶ú'], divine: ['üêâ','ü¶Ñ','üê¶‚Äçüî•'] }},
            food: { name: 'üçï Food', emojis: { common: ['üçé','üçê','üçä','üçã','üçå','üçâ','üçá','üçì','ü´ê','üçà','üçí','üçë','ü•≠','üçç','ü••','ü•ù','üçÖ','üçÜ','ü•ë','ü•¶'], uncommon: ['ü•¨','ü•í','üå∂Ô∏è','ü´ë','üåΩ','ü•ï','üßÑ','üßÖ','ü•î','üç†'], rare: ['ü•ê','ü•Ø','üçû','ü•ñ','ü•®','üßÄ','ü•ö','üç≥','üßà','ü•û'], epic: ['üßá','ü•ì','ü•©','üçó','üçñ','üå≠','üçî','üçü','üçï','ü•™'], legendary: ['üç¶','ü•ß','üßÅ','üç∞','üéÇ','üçÆ','üç≠','üç¨','üç´','üçø'], mythic: ['üç∂','üç∫','üçª','ü•Ç','üç∑','ü•É','üç∏','üçπ'], divine: ['üçæ','ü•Ç','üèÜ'] }},
            sports: { name: '‚öΩ Sports', emojis: { common: ['‚öΩ','üèÄ','üèà','‚öæ','ü•é','üéæ','üèê','üèâ','ü•è','üé±','ü™Ä','üèì','üè∏','üèí','üèë','ü•ç','üèè','ü™É','ü•Ö','‚õ≥'], uncommon: ['üéø','üõ∑','ü•å','‚õ∏Ô∏è','üõπ','üõº','üõ∂','üö£','üèä','ü§Ω'], rare: ['üèÜ','ü•á','ü•à','ü•â','üèÖ','üéñÔ∏è','üèµÔ∏è','üéóÔ∏è','üé´','üéüÔ∏è'], epic: ['ü•ä','ü•ã','üéØ','üé≥','üé∞','üé≤','‚ôüÔ∏è','üß©','üéÆ','üïπÔ∏è'], legendary: ['üèÜ','üëë','üí™','ü¶æ','üî•','‚ö°','üí•','‚ú®'], mythic: ['üèüÔ∏è','üé™','üé≠','üé¨','üé§','üéß'], divine: ['üèÜ','üëë','üíé'] }},
            music: { name: 'üéµ Music', emojis: { common: ['üéµ','üé∂','üéº','‚ô©','‚ô™','‚ô´','‚ô¨','üîä','üîâ','üîà','üîá','üì¢','üì£','üìØ','üîî','üîï','üéôÔ∏è','üéöÔ∏è','üéõÔ∏è','üé§'], uncommon: ['üéß','üìª','üé∑','üé∏','üéπ','üé∫','üéª','ü™ï','ü™ò','ü™ó'], rare: ['ü•Å','ü™á','üé¨','üé≠','üé™','üé´','üéüÔ∏è','üé†','üé°','üé¢'], epic: ['üìÄ','üíø','üìº','üìπ','üì∑','üì∏','üé•','üéûÔ∏è','üìΩÔ∏è','üé¨'], legendary: ['üåü','‚≠ê','‚ú®','üí´','üî•','üí•','üéÜ','üéá'], mythic: ['üé≠','üé¨','üé§','üéß','üéº','üéπ'], divine: ['üëë','üíé','üî±'] }},
            tech: { name: 'üíª Tech', emojis: { common: ['üíª','üñ•Ô∏è','üñ®Ô∏è','‚å®Ô∏è','üñ±Ô∏è','üñ≤Ô∏è','üíΩ','üíæ','üíø','üìÄ','üì±','üì≤','‚òéÔ∏è','üìû','üìü','üì†','üîã','üîå','üí°','üî¶'], uncommon: ['üïØÔ∏è','üßØ','üõ¢Ô∏è','‚öôÔ∏è','üîß','üî©','üî®','‚õèÔ∏è','üõ†Ô∏è','‚öíÔ∏è'], rare: ['üî≠','üî¨','üß¨','üß™','üß´','üß≤','üå°Ô∏è','üì°','üõ∞Ô∏è','üöÄ'], epic: ['ü§ñ','üëæ','üëΩ','üõ∏','üí£','üß®','ü™ì','‚öîÔ∏è','üó°Ô∏è','üî´'], legendary: ['ü§ñ','üëæ','üõ∏','üí´','‚ö°','üî•','üí•','‚ú®'], mythic: ['üåê','üîÆ','üíé','üßø','ü™¨','‚ú®'], divine: ['üî±','üëë','üíé'] }},
            fantasy: { name: 'üßô Fantasy', emojis: { common: ['‚≠ê','‚ú®','üí´','üåü','üîÆ','üßø','ü™¨','üé¥','üÄÑ','üé≤','‚ô†Ô∏è','‚ô£Ô∏è','‚ô•Ô∏è','‚ô¶Ô∏è','üÉè','üé≠','ü™Ü','ü™Ö','üéé','üéè'], uncommon: ['üßô','üßô‚Äç‚ôÇÔ∏è','üßô‚Äç‚ôÄÔ∏è','üßù','üßù‚Äç‚ôÇÔ∏è','üßù‚Äç‚ôÄÔ∏è','üßõ','üßõ‚Äç‚ôÇÔ∏è','üßõ‚Äç‚ôÄÔ∏è','üßü'], rare: ['üßú','üßú‚Äç‚ôÇÔ∏è','üßú‚Äç‚ôÄÔ∏è','üßö','üßö‚Äç‚ôÇÔ∏è','üßö‚Äç‚ôÄÔ∏è','üßû','üßû‚Äç‚ôÇÔ∏è','üßû‚Äç‚ôÄÔ∏è','üßå'], epic: ['üëπ','üë∫','üëª','üíÄ','‚ò†Ô∏è','üëΩ','üëæ','ü§ñ','üòà','üëø'], legendary: ['üêâ','ü¶Ñ','üê¶‚Äçüî•','üßô','üîÆ','‚ö°','üî•','‚ú®'], mythic: ['üè∞','üó°Ô∏è','‚öîÔ∏è','üõ°Ô∏è','üëë','üèõÔ∏è'], divine: ['üêâ','ü¶Ñ','üëë'] }},
            weather: { name: 'üå§Ô∏è Weather', emojis: { common: ['‚òÄÔ∏è','üå§Ô∏è','‚õÖ','üå•Ô∏è','‚òÅÔ∏è','üå¶Ô∏è','üåßÔ∏è','‚õàÔ∏è','üå©Ô∏è','üå®Ô∏è','‚ùÑÔ∏è','‚òÉÔ∏è','‚õÑ','üå¨Ô∏è','üí®','üíß','üí¶','‚òî','üåÇ','üåà'], uncommon: ['üå™Ô∏è','üå´Ô∏è','üåä','üî•','‚ö°','‚ú®','üí´','üåü','‚≠ê','üåô'], rare: ['üå°Ô∏è','üßä','‚ùÑÔ∏è','üèîÔ∏è','üåã','üåÖ','üåÑ','üåá','üåÜ','üåÉ'], epic: ['‚òÑÔ∏è','üí•','üî•','‚ö°','üå™Ô∏è','üåä','üèîÔ∏è','üåã','üåà','‚ú®'], legendary: ['üåà','üåÖ','üåÑ','‚òÄÔ∏è','üåô','‚≠ê','‚ú®','üí´'], mythic: ['üåç','üåé','üåè','ü™ê','üåå','üå†'], divine: ['üî±','üëë','üíé'] }},
            love: { name: 'üíñ Love', emojis: { common: ['‚ù§Ô∏è','üß°','üíõ','üíö','üíô','üíú','üñ§','ü§ç','ü§é','üíî','‚ù£Ô∏è','üíï','üíû','üíì','üíó','üíñ','üíò','üíù','üíü','‚ô•Ô∏è'], uncommon: ['üòç','ü•∞','üòò','üòª','üíë','üë©‚Äç‚ù§Ô∏è‚Äçüë®','üë®‚Äç‚ù§Ô∏è‚Äçüë®','üë©‚Äç‚ù§Ô∏è‚Äçüë©','üíè','üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®'], rare: ['üåπ','üå∑','üå∏','üå∫','üíê','üéÄ','üéÅ','üíç','üíé','‚ú®'], epic: ['üíí','üè©','üíå','üïäÔ∏è','ü¶¢','üêá','üê∞','ü¶ã','üåà','‚òÄÔ∏è'], legendary: ['üíñ','üíò','üíù','üíï','üíû','‚ú®','üåü','üí´'], mythic: ['üíé','üëë','üîÆ','‚ú®','üåπ','üå∫'], divine: ['üíñ','üëë','üíé'] }},
            spooky: { name: 'üëª Spooky', emojis: { common: ['üëª','üíÄ','‚ò†Ô∏è','üëΩ','üëæ','üéÉ','üï∑Ô∏è','üï∏Ô∏è','ü¶á','üåë','üåö','üåù','üåõ','üåú','‚ö´','üñ§','üîÆ','ü™¶','‚ö∞Ô∏è','üßü'], uncommon: ['üëπ','üë∫','üòà','üëø','ü§°','üí©','üßõ','üßü‚Äç‚ôÇÔ∏è','üßü‚Äç‚ôÄÔ∏è','üßô'], rare: ['üî•','‚ö°','üí•','‚ú®','üå™Ô∏è','üå´Ô∏è','üåä','‚òÑÔ∏è','üåã','üèöÔ∏è'], epic: ['‚öîÔ∏è','üó°Ô∏è','üî™','ü™ì','üí£','üß®','ü™§','‚õìÔ∏è','üîó','ü©∏'], legendary: ['üíÄ','üëª','üòà','üéÉ','ü¶á','üï∑Ô∏è','üî•','‚ö°'], mythic: ['üè∞','üèöÔ∏è','üåë','üåå','‚ö∞Ô∏è','ü™¶'], divine: ['üíÄ','üëë','üî±'] }},
            christmas: { name: 'üéÑ Christmas', emojis: { common: ['üéÑ','üéÖ','ü§∂','üßë‚ÄçüéÑ','üéÅ','üéÄ','üéä','üéâ','‚ùÑÔ∏è','‚õÑ','‚òÉÔ∏è','üå®Ô∏è','üîî','üîï','üé∂','üéµ','üåü','‚≠ê','‚ú®','üí´'], uncommon: ['ü¶å','üõ∑','üéø','‚õ∑Ô∏è','üèÇ','üß§','üß£','üß•','üë¢','üïØÔ∏è'], rare: ['üè†','üè°','üèòÔ∏è','üé†','üé°','üé¢','üé™','üé≠','üé¨','üé§'], epic: ['üç™','ü•õ','üç´','üç¨','üç≠','‚òï','üçµ','üßÅ','üç∞','üéÇ'], legendary: ['üéÑ','üéÖ','üéÅ','‚ú®','üåü','‚ùÑÔ∏è','‚õÑ','üîî'], mythic: ['üèîÔ∏è','üåå','üåô','‚≠ê','üí´','‚ú®'], divine: ['üéÑ','üëë','üíé'] }},
            summer: { name: '‚òÄÔ∏è Summer', emojis: { common: ['‚òÄÔ∏è','üå§Ô∏è','‚õÖ','üå¥','üèñÔ∏è','üèùÔ∏è','üåä','üèÑ','üèä','ü§Ω','üö£','üõ∂','‚õµ','üö§','üõ•Ô∏è','üõ≥Ô∏è','‚öì','üêö','ü¶Ä','ü¶ê'], uncommon: ['üçâ','üçß','üç®','üç¶','ü•§','üßä','üçπ','ü••','ü•≠','üçç'], rare: ['üå∫','üå∏','üåº','üåª','üå∑','üåπ','üíê','ü¶ã','üêù','üåà'], epic: ['üé°','üé¢','üé†','üé™','üé≠','üé¨','üé§','üéß','üéµ','üé∂'], legendary: ['üåÖ','üåÑ','üåá','‚òÄÔ∏è','üåä','üèùÔ∏è','üå¥','üå∫'], mythic: ['üåç','üèîÔ∏è','üåã','üóª','üèúÔ∏è','üåå'], divine: ['‚òÄÔ∏è','üëë','üíé'] }},
            gaming: { name: 'üéÆ Gaming', emojis: { common: ['üéÆ','üïπÔ∏è','üëæ','üé≤','üéØ','üé≥','üé∞','üÉè','üÄÑ','üé¥','‚ô†Ô∏è','‚ô£Ô∏è','‚ô•Ô∏è','‚ô¶Ô∏è','üî¥','üü†','üü°','üü¢','üîµ','üü£'], uncommon: ['üèÜ','ü•á','ü•à','ü•â','üèÖ','üéñÔ∏è','‚öîÔ∏è','üó°Ô∏è','üõ°Ô∏è','üî´'], rare: ['ü§ñ','üëΩ','üëæ','üõ∏','üí£','üß®','üí•','‚ö°','üî•','‚ú®'], epic: ['üíé','üëë','üîÆ','üßø','üí∞','üíµ','üí¥','üí∂','üí∑','üí∏'], legendary: ['üéÆ','üïπÔ∏è','üëæ','üèÜ','üíé','üëë','‚öîÔ∏è','üî•'], mythic: ['üåü','‚ú®','üí´','‚≠ê','üîÆ','üåå'], divine: ['üéÆ','üëë','üíé'] }},
            royal: { name: 'üëë Royal', emojis: { common: ['üëë','üè∞','üèØ','üèõÔ∏è','‚öúÔ∏è','üî±','üé≠','üé™','üé†','üé°','üé¢','üó°Ô∏è','‚öîÔ∏è','üõ°Ô∏è','üèπ','üîÆ','üßø','üíé','üíç','üìø'], uncommon: ['ü¶Å','ü¶Ö','üêâ','ü¶Ñ','üêé','ü¶å','ü¶¢','ü¶ö','ü¶ú','üê∫'], rare: ['üç∑','ü•Ç','üçæ','üèÜ','ü•á','üéñÔ∏è','üéóÔ∏è','üåπ','üå∫','üíê'], epic: ['üí∞','üíµ','üí¥','üí∂','üí∑','üí∏','üí≥','üßæ','üíπ','üìä'], legendary: ['üëë','üè∞','üî±','‚öúÔ∏è','üíé','ü¶Å','üêâ','‚ú®'], mythic: ['üåå','üåü','‚≠ê','üí´','‚ú®','üîÆ'], divine: ['üëë','üíé','üî±'] }},
            cute: { name: 'ü•∫ Cute', emojis: { common: ['ü•∫','ü•π','üòä','üòá','ü•∞','üòç','üòò','üòª','üòΩ','üò∏','üò∫','üê±','üê∂','üê∞','üêπ','üêª','üß∏','üéÄ','üíñ','üíï'], uncommon: ['ü¶ä','üêº','üê®','üêØ','ü¶Å','üêÆ','üê∑','üê∏','üêµ','üôä'], rare: ['üå∏','üå∑','üåπ','üå∫','üåª','üåº','üíê','ü¶ã','üêù','üåà'], epic: ['üç∞','üßÅ','üç©','üç™','üç≠','üç¨','üç´','üéÇ','üç¶','üßá'], legendary: ['ü•∫','üíñ','‚ú®','üå∏','ü¶ã','üåà','üíï','üéÄ'], mythic: ['üåü','‚≠ê','üí´','‚ú®','üîÆ','üíé'], divine: ['ü•∫','üëë','üíñ'] }},
            ninja: { name: 'ü•∑ Ninja', emojis: { common: ['ü•∑','‚öîÔ∏è','üó°Ô∏è','üî™','ü™ì','üèπ','üõ°Ô∏è','‚õìÔ∏è','üîó','üí¢','üí•','‚ú®','üí´','üåü','‚≠ê','üî¥','‚ö´','üñ§','üåë','üåö'], uncommon: ['üêâ','üêç','ü¶Ç','ü¶é','ü¶á','üê∫','ü¶Ö','ü¶ä','üêØ','üêª'], rare: ['üèØ','üè∞','üóæ','üéå','üéè','üéé','üéê','üßß','ü™≠','ü™¨'], epic: ['üí£','üß®','ü™§','üî•','‚ö°','üå™Ô∏è','üåä','üí®','üå´Ô∏è','‚òÑÔ∏è'], legendary: ['ü•∑','‚öîÔ∏è','üêâ','üíÄ','üî•','‚ö°','üí•','‚ú®'], mythic: ['üèØ','üåô','üåå','üåë','‚≠ê','üîÆ'], divine: ['ü•∑','üëë','üêâ'] }}
        };

        const RARITY_CHANCES = { common: 50, uncommon: 30, rare: 12, epic: 5, legendary: 2, mythic: 0.8, divine: 0.2 };
        const RARITY_POINTS = { common: 10, uncommon: 25, rare: 100, epic: 500, legendary: 2500, mythic: 10000, divine: 50000 };
        const RARITY_SELL = { common: 500, uncommon: 2000, rare: 10000, epic: 25000, legendary: 75000, mythic: 200000, divine: 500000 };
        const RARITY_COLORS = { common: '#9ca3af', uncommon: '#22c55e', rare: '#3b82f6', epic: '#a855f7', legendary: '#fbbf24', mythic: '#ec4899', divine: '#06b6d4' };
        const PACK_PRICE = 7500;

        const ROULETTE_NUMBERS = [
            { num: 0, color: 'green' },
            { num: 32, color: 'red' }, { num: 15, color: 'black' }, { num: 19, color: 'red' }, { num: 4, color: 'black' },
            { num: 21, color: 'red' }, { num: 2, color: 'black' }, { num: 25, color: 'red' }, { num: 17, color: 'black' },
            { num: 34, color: 'red' }, { num: 6, color: 'black' }, { num: 27, color: 'red' }, { num: 13, color: 'black' },
            { num: 36, color: 'red' }, { num: 11, color: 'black' }, { num: 30, color: 'red' }, { num: 8, color: 'black' },
            { num: 23, color: 'red' }, { num: 10, color: 'black' }, { num: 5, color: 'red' }, { num: 24, color: 'black' },
            { num: 16, color: 'red' }, { num: 33, color: 'black' }, { num: 1, color: 'red' }, { num: 20, color: 'black' },
            { num: 14, color: 'red' }, { num: 31, color: 'black' }, { num: 9, color: 'red' }, { num: 22, color: 'black' },
            { num: 18, color: 'red' }, { num: 29, color: 'black' }, { num: 7, color: 'red' }, { num: 28, color: 'black' },
            { num: 12, color: 'red' }, { num: 35, color: 'black' }, { num: 3, color: 'red' }, { num: 26, color: 'black' }
        ];

        const PLINKO_MULTIPLIERS = [100, 25, 10, 5, 2, 1, 0.5, 0.2, 0.5, 1, 2, 5, 10, 25, 100];

        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('lintoriaUser');
            if (saved) { currentUser = JSON.parse(saved); showApp(); }
        });

        function showToast(msg, type = 'info') {
            const t = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = msg;
            t.className = 'toast show ' + type;
            setTimeout(() => t.className = 'toast', 3000);
        }

        async function apiCall(params) {
            try {
                const r = await fetch(SHEETS_URL + '?' + new URLSearchParams(params).toString(), { method: 'GET', redirect: 'follow' });
                const t = await r.text();
                try { return JSON.parse(t); } catch { return { success: false }; }
            } catch { return { success: false }; }
        }

        function switchAuthTab(tab) {
            document.querySelectorAll('#authScreen .tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('loginTab').classList.toggle('hidden', tab !== 'login');
            document.getElementById('registerTab').classList.toggle('hidden', tab !== 'register');
        }

        async function login() {
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;
            if (!email || !password) { showToast('Fill all fields', 'error'); return; }
            showToast('Logging in...');
            const data = await apiCall({ action: 'login', email, password });
            if (data.success) {
                currentUser = data.user;
                localStorage.setItem('lintoriaUser', JSON.stringify(currentUser));
                showToast('Welcome!', 'success');
                showApp();
            } else showToast(data.error || 'Failed', 'error');
        }

        async function register() {
            const email = document.getElementById('registerEmail').value.trim().toLowerCase();
            const name = document.getElementById('registerName').value.trim();
            const password = document.getElementById('registerPassword').value;
            if (!email || !name || !password) { showToast('Fill all fields', 'error'); return; }
            showToast('Creating...');
            const data = await apiCall({ action: 'register', email, name, password });
            if (data.success) {
                currentUser = data.user;
                localStorage.setItem('lintoriaUser', JSON.stringify(currentUser));
                showToast('Account created!', 'success');
                showApp();
            } else showToast(data.message || 'Failed', 'error');
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('lintoriaUser');
            document.getElementById('appScreen').classList.add('hidden');
            document.getElementById('authScreen').classList.remove('hidden');
        }

        function showApp() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('appScreen').classList.remove('hidden');
            document.getElementById('userName').textContent = currentUser.name;
            loadDashboard();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tab + 'Content').classList.remove('hidden');
            event.target.classList.add('active');
            if (tab === 'dashboard') loadDashboard();
            if (tab === 'packs') loadPacks();
            if (tab === 'collection') loadCollection();
            if (tab === 'casino') { initRoulette(); initPlinko(); }
            if (tab === 'leaderboard') loadLeaderboards();
        }

        async function loadDashboard() {
            const data = await apiCall({ action: 'getDashboard', email: currentUser.email });
            if (data.success) {
                currentUser.balance = data.balance || 0;
                document.getElementById('balanceAmount').textContent = formatNumber(data.balance || 0);
                document.getElementById('creditScoreDisplay').textContent = data.creditScore || 650;
                document.getElementById('emojiScoreDisplay').textContent = data.emojiScore || 0;
            } else {
                document.getElementById('balanceAmount').textContent = formatNumber(currentUser.balance || 100000);
            }
        }

        async function transferMoney() {
            const to = document.getElementById('recipientEmail').value.trim().toLowerCase();
            const amount = parseFloat(document.getElementById('transferAmount').value);
            if (!to || !amount || amount <= 0) { showToast('Enter valid details', 'error'); return; }
            if (amount > currentUser.balance) { showToast('Insufficient balance', 'error'); return; }
            const data = await apiCall({ action: 'transfer', from: currentUser.email, to, amount, note: document.getElementById('transferNote').value });
            if (data.success) {
                currentUser.balance -= amount;
                document.getElementById('balanceAmount').textContent = formatNumber(currentUser.balance);
                showToast('Sent!', 'success');
            } else showToast(data.message || 'Failed', 'error');
        }

        // PACKS
        function loadPacks() {
            const c = document.getElementById('packsList');
            c.innerHTML = Object.entries(THEMED_PACKS).map(([key, pack]) => {
                const preview = [pack.emojis.common[0], pack.emojis.rare[0], pack.emojis.legendary[0], pack.emojis.divine[0]].join('');
                return `<div class="pack-card ${selectedPack === key ? 'selected' : ''}" onclick="selectPack('${key}')"><div class="pack-name">${pack.name}</div><div class="pack-emojis">${preview}</div></div>`;
            }).join('');
        }

        function selectPack(key) {
            selectedPack = key;
            loadPacks();
            document.getElementById('buyPackBtn').disabled = false;
            document.getElementById('viewPackBtn').disabled = false;
            document.getElementById('selectedPackName').textContent = 'Selected: ' + THEMED_PACKS[key].name;
        }

        async function buyPack() {
            if (!selectedPack) { showToast('Select a pack!', 'error'); return; }
            if (currentUser.balance < PACK_PRICE) { showToast('Need $7,500!', 'error'); return; }
            const pack = THEMED_PACKS[selectedPack];
            const roll = Math.random() * 100;
            let cumulative = 0, rarity = 'common';
            for (const [r, chance] of Object.entries(RARITY_CHANCES)) {
                cumulative += chance;
                if (roll < cumulative) { rarity = r; break; }
            }
            const pool = pack.emojis[rarity] || pack.emojis.common;
            const emoji = pool[Math.floor(Math.random() * pool.length)];
            showToast('Opening...');
            const data = await apiCall({ action: 'buyPack', email: currentUser.email, pack: selectedPack, emoji: encodeURIComponent(emoji), rarity, points: RARITY_POINTS[rarity], price: PACK_PRICE });
            currentUser.balance = data.newBalance || (currentUser.balance - PACK_PRICE);
            document.getElementById('balanceAmount').textContent = formatNumber(currentUser.balance);
            showPackOpening(emoji, rarity, data.isDuplicate || false);
        }

        function showPackOpening(emoji, rarity, isDuplicate) {
            const m = document.getElementById('packOpeningModal');
            m.className = 'pack-opening';
            m.innerHTML = `<div class="pack-reveal">${emoji}</div><div class="pack-rarity-text" style="color:${RARITY_COLORS[rarity]}">${rarity.toUpperCase()}!</div><p style="margin-top:1rem;color:var(--text-muted)">${isDuplicate ? '(Duplicate)' : '+' + RARITY_POINTS[rarity] + ' pts'}</p><p style="margin-top:0.5rem;color:var(--text-secondary)">Sell: $${formatNumber(RARITY_SELL[rarity])}</p><button class="btn" onclick="closePackOpening()" style="margin-top:1.5rem">Continue</button>`;
        }

        function closePackOpening() { document.getElementById('packOpeningModal').className = 'hidden'; }

        function showPackContentsModal() {
            if (!selectedPack) return;
            const pack = THEMED_PACKS[selectedPack];
            const m = document.getElementById('packContentsModal');
            document.getElementById('packContentsTitle').textContent = pack.name + ' Contents';
            const rarities = ['divine', 'mythic', 'legendary', 'epic', 'rare', 'uncommon', 'common'];
            let html = '';
            rarities.forEach(r => {
                if (pack.emojis[r] && pack.emojis[r].length > 0) {
                    html += `<div class="rarity-section"><div class="rarity-section-header"><span class="rarity-badge ${r}">${r}</span><span style="color:var(--text-muted);font-size:0.75rem">${RARITY_CHANCES[r]}% ‚Ä¢ ${RARITY_POINTS[r]} pts</span></div><div class="pack-contents-grid">${pack.emojis[r].map(e => `<div class="pack-emoji-item" style="background:${RARITY_COLORS[r]}22;border:1px solid ${RARITY_COLORS[r]}">${e}</div>`).join('')}</div></div>`;
                }
            });
            document.getElementById('packContentsBody').innerHTML = html;
            m.classList.add('active');
        }

        function closePackContentsModal() { document.getElementById('packContentsModal').classList.remove('active'); }
        function showChancesModal() { document.getElementById('chancesModal').classList.add('active'); }
        function closeChancesModal() { document.getElementById('chancesModal').classList.remove('active'); }

        async function loadCollection() {
            const data = await apiCall({ action: 'getCollection', email: currentUser.email });
            if (data.success) {
                document.getElementById('emojiScore').textContent = (data.totalPoints || 0) + ' pts';
                const c = document.getElementById('emojiCollection');
                if (!data.emojis || data.emojis.length === 0) {
                    c.innerHTML = '<div class="empty-state"><div class="empty-icon">üéí</div><p>No emojis yet</p></div>';
                } else {
                    c.innerHTML = data.emojis.map(e => `<div class="emoji-card ${e.rarity}" onclick="sellEmoji('${encodeURIComponent(e.emoji)}','${e.rarity}')"><span class="emoji">${e.emoji}</span><span class="rarity-badge ${e.rarity}">${e.rarity}</span><span style="font-size:0.65rem;color:var(--text-muted)">$${formatNumber(RARITY_SELL[e.rarity])}</span></div>`).join('');
                }
            }
        }

        async function sellEmoji(emoji, rarity) {
            if (!confirm('Sell for $' + formatNumber(RARITY_SELL[rarity]) + '?')) return;
            const data = await apiCall({ action: 'sellEmoji', email: currentUser.email, emoji, rarity, price: RARITY_SELL[rarity], points: RARITY_POINTS[rarity] });
            if (data.success) {
                currentUser.balance = data.newBalance;
                document.getElementById('balanceAmount').textContent = formatNumber(data.newBalance);
                showToast('Sold!', 'success');
                loadCollection();
            }
        }

        // CASINO - PLINKO with PHYSICS
        function initPlinko() {
            const board = document.getElementById('plinkoBoard');
            if (!board) return;
            board.innerHTML = '';
            const w = board.offsetWidth || 360, h = board.offsetHeight || 400;
            const rows = 10, pegSpacing = 28, startY = 35;
            for (let row = 0; row < rows; row++) {
                const pegsInRow = row + 3;
                const rowWidth = (pegsInRow - 1) * pegSpacing;
                const startX = (w - rowWidth) / 2;
                for (let col = 0; col < pegsInRow; col++) {
                    const peg = document.createElement('div');
                    peg.className = 'plinko-peg';
                    peg.style.left = (startX + col * pegSpacing) + 'px';
                    peg.style.top = (startY + row * 30) + 'px';
                    board.appendChild(peg);
                }
            }
            const slots = document.createElement('div');
            slots.className = 'plinko-slots';
            PLINKO_MULTIPLIERS.forEach((mult, i) => {
                const slot = document.createElement('div');
                slot.className = 'plinko-slot';
                slot.dataset.mult = mult;
                slot.dataset.index = i;
                slot.textContent = mult + 'x';
                slots.appendChild(slot);
            });
            board.appendChild(slots);
        }

        async function playPlinko() {
            const bet = parseFloat(document.getElementById('plinkoBet').value);
            if (!bet || bet <= 0) { showToast('Enter bet', 'error'); return; }
            if (bet > currentUser.balance) { showToast('Insufficient balance', 'error'); return; }
            document.getElementById('plinkoBtn').disabled = true;
            document.getElementById('plinkoResult').innerHTML = '';
            const board = document.getElementById('plinkoBoard');
            const w = board.offsetWidth || 360, h = board.offsetHeight || 400;
            board.querySelectorAll('.plinko-ball').forEach(b => b.remove());
            const ball = document.createElement('div');
            ball.className = 'plinko-ball';
            board.appendChild(ball);
            let x = w / 2 + (Math.random() - 0.5) * 30, y = 10, vx = 0, vy = 0;
            const gravity = 0.25, bounce = 0.65, friction = 0.98;
            const pegs = Array.from(board.querySelectorAll('.plinko-peg')).map(peg => ({ x: parseFloat(peg.style.left), y: parseFloat(peg.style.top), r: 4 }));
            const ballR = 8;
            let landed = false;
            function animate() {
                if (landed) return;
                vy += gravity;
                vx *= friction;
                x += vx;
                y += vy;
                if (x < ballR) { x = ballR; vx = -vx * bounce; }
                if (x > w - ballR) { x = w - ballR; vx = -vx * bounce; }
                pegs.forEach(peg => {
                    const dx = x - peg.x, dy = y - peg.y, dist = Math.sqrt(dx * dx + dy * dy), minDist = ballR + peg.r;
                    if (dist < minDist) {
                        const angle = Math.atan2(dy, dx), overlap = minDist - dist;
                        x += Math.cos(angle) * overlap;
                        y += Math.sin(angle) * overlap;
                        const nx = Math.cos(angle), ny = Math.sin(angle), dot = vx * nx + vy * ny;
                        vx = (vx - 2 * dot * nx) * bounce + (Math.random() - 0.5) * 1.5;
                        vy = (vy - 2 * dot * ny) * bounce;
                    }
                });
                ball.style.left = x + 'px';
                ball.style.top = y + 'px';
                if (y > h - 50) {
                    landed = true;
                    const slotWidth = 32, slotsStart = (w - 15 * slotWidth) / 2;
                    let finalSlot = Math.floor((x - slotsStart) / slotWidth);
                    finalSlot = Math.max(0, Math.min(14, finalSlot));
                    finishPlinko(bet, finalSlot, ball);
                    return;
                }
                requestAnimationFrame(animate);
            }
            animate();
        }

        async function finishPlinko(bet, slotIndex, ball) {
            const mult = PLINKO_MULTIPLIERS[slotIndex], winnings = bet * mult, profit = winnings - bet, win = profit > 0;
            const slots = document.querySelectorAll('.plinko-slot');
            slots[slotIndex].classList.add('active');
            ball.classList.add(win ? 'win-animation' : 'lose-animation');
            await apiCall({ action: 'recordGambling', email: currentUser.email, game: 'plinko', wagered: bet, won: win ? winnings : 0, lost: win ? 0 : bet, result: win ? 'win' : 'loss' });
            currentUser.balance += profit;
            document.getElementById('balanceAmount').textContent = formatNumber(currentUser.balance);
            document.getElementById('plinkoResult').innerHTML = win ? `<span style="color:var(--success)" class="win-animation">${mult}x WIN! +$${formatNumber(profit)}</span>` : `<span style="color:var(--danger)" class="lose-animation">${mult}x LOSE -$${formatNumber(Math.abs(profit))}</span>`;
            setTimeout(() => { slots[slotIndex].classList.remove('active'); ball.remove(); document.getElementById('plinkoBtn').disabled = false; }, 2000);
        }

        // ROULETTE with SPINNING
        function initRoulette() {
            const wheel = document.getElementById('rouletteWheel');
            if (!wheel) return;
            wheel.innerHTML = '';
            const segAngle = 360 / ROULETTE_NUMBERS.length;
            ROULETTE_NUMBERS.forEach((item, i) => {
                const seg = document.createElement('div');
                seg.className = 'roulette-segment';
                seg.style.transform = `rotate(${i * segAngle - 90}deg) skewY(${90 - segAngle}deg)`;
                seg.style.background = item.color === 'red' ? '#dc2626' : item.color === 'black' ? '#1f2937' : '#16a34a';
                seg.innerHTML = `<span style="transform:skewY(${segAngle - 90}deg) rotate(${segAngle / 2}deg)">${item.num}</span>`;
                wheel.appendChild(seg);
            });
        }

        function selectRouletteBet(bet) {
            selectedRouletteBet = bet;
            document.querySelectorAll('.roulette-bet-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('bet' + bet.charAt(0).toUpperCase() + bet.slice(1)).classList.add('selected');
            document.getElementById('rouletteBtn').disabled = false;
        }

        async function playRoulette() {
            if (!selectedRouletteBet) { showToast('Select a bet!', 'error'); return; }
            const bet = parseFloat(document.getElementById('rouletteBet').value);
            if (!bet || bet <= 0) { showToast('Enter bet', 'error'); return; }
            if (bet > currentUser.balance) { showToast('Insufficient balance', 'error'); return; }
            document.getElementById('rouletteBtn').disabled = true;
            document.getElementById('rouletteResult').innerHTML = '';
            document.querySelectorAll('.roulette-bet-btn').forEach(b => b.disabled = true);
            const wheel = document.getElementById('rouletteWheel');
            const resultIdx = Math.floor(Math.random() * ROULETTE_NUMBERS.length);
            const result = ROULETTE_NUMBERS[resultIdx];
            const segAngle = 360 / ROULETTE_NUMBERS.length;
            const targetAngle = 360 - (resultIdx * segAngle) - segAngle / 2;
            const spins = 5 + Math.floor(Math.random() * 3);
            const totalRot = spins * 360 + targetAngle;
            wheel.style.transition = 'transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99)';
            wheel.style.transform = `rotate(${totalRot}deg)`;
            setTimeout(async () => {
                let mult = 0, win = false;
                if (selectedRouletteBet === 'green' && result.color === 'green') { mult = 14; win = true; }
                else if (selectedRouletteBet === 'red' && result.color === 'red') { mult = 1.8; win = true; }
                else if (selectedRouletteBet === 'black' && result.color === 'black') { mult = 1.8; win = true; }
                const winnings = bet * mult, profit = winnings - bet;
                await apiCall({ action: 'recordGambling', email: currentUser.email, game: 'roulette', wagered: bet, won: win ? winnings : 0, lost: win ? 0 : bet, result: win ? 'win' : 'loss' });
                currentUser.balance += profit;
                document.getElementById('balanceAmount').textContent = formatNumber(currentUser.balance);
                const colorEmoji = result.color === 'red' ? 'üî¥' : result.color === 'black' ? '‚ö´' : 'üü¢';
                document.getElementById('rouletteResult').innerHTML = `<div class="${win ? 'win-animation' : 'lose-animation'}">${colorEmoji} ${result.num}<br>${win ? `<span style="color:var(--success)">WIN! +$${formatNumber(profit)}</span>` : `<span style="color:var(--danger)">LOSE -$${formatNumber(bet)}</span>`}</div>`;
                setTimeout(() => { wheel.style.transition = 'none'; wheel.style.transform = `rotate(${targetAngle}deg)`; document.getElementById('rouletteBtn').disabled = false; document.querySelectorAll('.roulette-bet-btn').forEach(b => b.disabled = false); }, 1000);
            }, 5000);
        }

        // DICE
        async function playDice() {
            const bet = parseFloat(document.getElementById('diceBet').value);
            if (!bet || bet <= 0) { showToast('Enter bet', 'error'); return; }
            if (bet > currentUser.balance) { showToast('Insufficient balance', 'error'); return; }
            document.getElementById('diceBtn').disabled = true;
            const dice = document.getElementById('dice');
            dice.classList.add('rolling');
            const roll = Math.floor(Math.random() * 6) + 1;
            const win = roll >= 4 && Math.random() < 0.8;
            const mult = win ? 1.9 : 0, winnings = bet * mult, profit = winnings - bet;
            setTimeout(async () => {
                dice.classList.remove('rolling');
                const faces = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];
                dice.querySelector('.front').textContent = faces[roll - 1];
                await apiCall({ action: 'recordGambling', email: currentUser.email, game: 'dice', wagered: bet, won: win ? winnings : 0, lost: win ? 0 : bet, result: win ? 'win' : 'loss' });
                currentUser.balance += profit;
                document.getElementById('balanceAmount').textContent = formatNumber(currentUser.balance);
                document.getElementById('diceResult').innerHTML = `<div class="${win ? 'win-animation' : 'lose-animation'}">Rolled: ${roll}<br>${win ? `<span style="color:var(--success)">WIN! +$${formatNumber(profit)}</span>` : `<span style="color:var(--danger)">LOSE -$${formatNumber(bet)}</span>`}</div>`;
                document.getElementById('diceBtn').disabled = false;
            }, 1000);
        }

        // SLOTS
        async function playSlots() {
            const bet = parseFloat(document.getElementById('slotsBet').value);
            if (!bet || bet <= 0) { showToast('Enter bet', 'error'); return; }
            if (bet > currentUser.balance) { showToast('Insufficient balance', 'error'); return; }
            document.getElementById('slotsBtn').disabled = true;
            const symbols = ['üçí', 'üçã', 'üçä', 'üçá', 'üíé', 'üé∞', 'üí∞'];
            const reels = document.querySelectorAll('.slot-reel');
            reels.forEach(r => r.classList.add('spinning'));
            const roll = Math.random();
            let result, mult = 0;
            if (roll < 0.01) { result = ['üí∞', 'üí∞', 'üí∞']; mult = 25; }
            else if (roll < 0.05) { result = ['üíé', 'üíé', 'üíé']; mult = 10; }
            else if (roll < 0.15) { const s = symbols[Math.floor(Math.random() * 4)]; result = [s, s, s]; mult = 5; }
            else if (roll < 0.35) { const s = symbols[Math.floor(Math.random() * 4)]; result = [s, s, symbols[(Math.floor(Math.random() * 3) + 1) % 7]]; mult = 1.5; }
            else { result = [symbols[Math.floor(Math.random() * 7)], symbols[Math.floor(Math.random() * 7)], symbols[Math.floor(Math.random() * 7)]]; }
            const win = mult > 0, winnings = bet * mult, profit = winnings - bet;
            reels.forEach((reel, i) => { setTimeout(() => { reel.classList.remove('spinning'); reel.querySelector('.slot-symbol').textContent = result[i]; }, 500 + i * 500); });
            setTimeout(async () => {
                await apiCall({ action: 'recordGambling', email: currentUser.email, game: 'slots', wagered: bet, won: win ? winnings : 0, lost: win ? 0 : bet, result: win ? 'win' : 'loss' });
                currentUser.balance += profit;
                document.getElementById('balanceAmount').textContent = formatNumber(currentUser.balance);
                document.getElementById('slotsResult').innerHTML = `<div class="${win ? 'win-animation' : 'lose-animation'}">${win ? `<span style="color:var(--success)">${mult}x WIN! +$${formatNumber(profit)}</span>` : `<span style="color:var(--danger)">LOSE -$${formatNumber(bet)}</span>`}</div>`;
                document.getElementById('slotsBtn').disabled = false;
            }, 2000);
        }

        // COIN FLIP
        async function playCoinFlip(choice) {
            const bet = parseFloat(document.getElementById('coinBet').value);
            if (!bet || bet <= 0) { showToast('Enter bet', 'error'); return; }
            if (bet > currentUser.balance) { showToast('Insufficient balance', 'error'); return; }
            document.getElementById('headsBtn').disabled = true;
            document.getElementById('tailsBtn').disabled = true;
            const coin = document.getElementById('coin');
            coin.classList.add('flipping');
            const result = Math.random() < 0.5 ? 'heads' : 'tails';
            const win = choice === result && Math.random() < 0.9;
            const mult = win ? 1.9 : 0, winnings = bet * mult, profit = winnings - bet;
            setTimeout(async () => {
                coin.classList.remove('flipping');
                coin.style.transform = result === 'heads' ? 'rotateY(0deg)' : 'rotateY(180deg)';
                await apiCall({ action: 'recordGambling', email: currentUser.email, game: 'coinflip', wagered: bet, won: win ? winnings : 0, lost: win ? 0 : bet, result: win ? 'win' : 'loss' });
                currentUser.balance += profit;
                document.getElementById('balanceAmount').textContent = formatNumber(currentUser.balance);
                document.getElementById('coinResult').innerHTML = `<div class="${win ? 'win-animation' : 'lose-animation'}">${result === 'heads' ? 'üëë' : 'ü¶Ö'} ${result.toUpperCase()}<br>${win ? `<span style="color:var(--success)">WIN! +$${formatNumber(profit)}</span>` : `<span style="color:var(--danger)">LOSE -$${formatNumber(bet)}</span>`}</div>`;
                document.getElementById('headsBtn').disabled = false;
                document.getElementById('tailsBtn').disabled = false;
            }, 1500);
        }

        // LEADERBOARD
        async function loadLeaderboards() {
            const data = await apiCall({ action: 'getLeaderboard' });
            if (data.success && data.users) {
                const c = document.getElementById('wealthLeaderboard');
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                c.innerHTML = data.users.slice(0, 20).map((u, i) => {
                    const isMe = u.email === currentUser.email;
                    return `<div class="transaction-item" style="${isMe ? 'border:2px solid var(--gold)' : ''}"><div style="display:flex;align-items:center;gap:0.75rem"><span style="font-size:1.25rem">${i < 3 ? medals[i] : '#' + (i + 1)}</span><span style="font-weight:600;${isMe ? 'color:var(--gold)' : ''}">${u.name}</span></div><span style="font-weight:700;color:var(--gold)">$${formatNumber(u.balance || 0)}</span></div>`;
                }).join('');
            }
        }

        // SETTINGS
        function showSettingsModal() { document.getElementById('settingsModal').classList.add('active'); }
        function closeSettingsModal() { document.getElementById('settingsModal').classList.remove('active'); }
        async function confirmResetAccount() {
            if (prompt('Type "RESET" to confirm:') !== 'RESET') return;
            const data = await apiCall({ action: 'resetAccount', email: currentUser.email });
            if (data.success) {
                currentUser.balance = data.newBalance || 100000;
                document.getElementById('balanceAmount').textContent = formatNumber(currentUser.balance);
                showToast('Account reset!', 'success');
                closeSettingsModal();
                loadDashboard();
            }
        }

        function formatNumber(n) { return n === undefined || n === null ? '0' : parseFloat(n).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 2 }); }

        setInterval(() => {
            if (currentUser && !document.hidden) {
                apiCall({ action: 'getBalance', email: currentUser.email }).then(d => { if (d.success) { currentUser.balance = d.balance; document.getElementById('balanceAmount').textContent = formatNumber(d.balance); } });
            }
        }, 30000);
    </script>
</body>
</html>
